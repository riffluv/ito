<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Online ITO – Single-Card Rule Prototype</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;color:#e6e6e6;background:#0f1216}
  :root{
    --panel:#171b21;--panel-2:#1d232c;--muted:#9aa3b2;
    --primary:#ff8a38;--accent:#66c2ff;--good:#2ecc71;--bad:#ff4d4f;
    --shadow:0 8px 24px rgba(0,0,0,.45);--radius:16px
  }
  .app{
    display:grid;gap:14px;padding:14px;min-height:100dvh;
    grid-template-rows:56px 1fr 160px;
    grid-template-columns:280px 1fr 340px;
    grid-template-areas:
      "header header header"
      "left   center right"
      "hand   hand   hand";
  }
  header.topbar{grid-area:header;background:linear-gradient(180deg,#171b21,#14181d);border:1px solid #262c36;border-radius:12px;display:flex;align-items:center;justify-content:space-between;padding:0 14px;box-shadow:var(--shadow)}
  .brand{display:flex;gap:10px;align-items:center;font-weight:800}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--primary);box-shadow:0 0 12px var(--primary)}
  .btn{background:#1c222b;border:1px solid #2b3442;color:#e8eaee;border-radius:10px;padding:8px 12px;cursor:pointer}
  .btn.primary{background:var(--primary);border-color:#ff9f5d;color:#141414;font-weight:800}
  .btn.ghost{background:transparent}
  .panel{background:radial-gradient(1200px 600px at 20% -20%,#1a2029 0%,#12161b 50%,#101317 100%);border:1px solid #242b35;border-radius:var(--radius);box-shadow:var(--shadow)}
  .panel.pad{padding:14px}

  aside.left{grid-area:left;display:grid;grid-template-rows:auto auto 1fr;gap:14px}
  aside.right{grid-area:right;display:grid;grid-template-rows:1fr auto;gap:14px}
  section.center{grid-area:center;display:grid;grid-template-rows:minmax(220px,34vh) 1fr;gap:14px}

  .players{padding:14px}
  .players h3{margin:0 0 8px;font-size:14px;color:var(--muted)}
  .player{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#151a21;border:1px solid #262e3a;border-radius:12px;margin-bottom:8px}
  .pill{padding:3px 8px;border-radius:999px;font-size:12px;background:#202734;border:1px solid #2f3a49;color:#b8c0cc}
  .ok{color:#9fe3aa}
  .pending{color:#ffd38f}

  .options{padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap}

  .chat{display:grid;grid-template-rows:1fr auto}
  .log{overflow:auto;padding:12px;display:grid;gap:8px}
  .msg{background:#151a21;border:1px solid #262e3a;border-radius:12px;padding:10px 12px}
  .msg.system{color:#9fb2c7}
  .chat-input{display:flex;gap:8px;padding:12px;border-top:1px dashed #25303e}
  .input{flex:1;background:#0f1318;border:1px solid #2b3442;border-radius:10px;padding:10px 12px;color:#e6e6e6}

  .shared-screen{display:grid;grid-template-rows:auto 1fr}
  .screen-head{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid #242b35}
  .screen-badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px;padding:6px 8px;border-radius:8px;background:#16202a;border:1px solid #263243;color:#b2c2d4}
  .screen-body{display:grid;grid-template-columns:1fr auto;gap:18px;padding:16px}
  .topic{font-size:clamp(18px,2.2vw,28px);font-weight:800}
  .sub{color:var(--muted);margin-top:6px;font-size:13px}
  .hintboard{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
  .hint{padding:6px 10px;border-radius:999px;border:1px solid #2b3442;background:#0f1318;font-size:12px;color:#c9d6e6}

  .table{padding:14px;display:grid;gap:10px}
  .table-head{display:flex;align-items:center;justify-content:space-between;color:var(--muted);font-size:13px}
  .dropzone{min-height:160px;border:2px dashed #2a3442;background:repeating-linear-gradient(45deg,#141a22,#141a22 10px,#131820 10px,#131820 20px);border-radius:16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;padding:12px}
  .dropzone.dragover{border-color:var(--accent);box-shadow:inset 0 0 0 1px var(--accent)}

  .card{width:74px;height:104px;border-radius:14px;background:linear-gradient(160deg,#212a36,#151b24);border:1px solid #2a3442;color:#f6f7f9;display:grid;place-items:center;box-shadow:0 6px 14px rgba(0,0,0,.35);user-select:none;cursor:grab;transition:transform .1s ease,box-shadow .1s ease,border-color .1s ease}
  .card:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.4)}
  .num{font-size:26px;font-weight:900;text-shadow:0 0 8px rgba(255,255,255,.08)}
  .face-down .num{filter:blur(10px)}
  .face-down::after{content:"?";position:absolute;font-weight:900;font-size:28px;color:#a6b4c6}

  .order{position:absolute;top:-6px;right:-6px;width:22px;height:22px;background:var(--primary);color:#101215;border-radius:50%;display:grid;place-items:center;font-weight:800;font-size:12px;border:2px solid #ffd6a6}
  .label{position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);font-size:11px;background:#0e1217;border:1px solid #2a3442;padding:2px 6px;border-radius:8px;color:#cfe2ff}

  footer.hand{grid-area:hand;background:linear-gradient(180deg,#13171c,#0f1418);border:1px solid #262c36;border-radius:12px;display:grid;grid-template-columns:1fr auto;gap:8px;padding:10px 12px;box-shadow:var(--shadow)}
  .hand-row{display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center}
  .hand-cards{display:flex;gap:8px;align-items:center}
  .word{width:280px;max-width:34vw;background:#0f1318;border:1px solid #2b3442;border-radius:10px;padding:10px 12px;color:#e6e6e6}

  .toast{position:fixed;left:50%;top:76px;transform:translateX(-50%) scale(.96);padding:12px 16px;border-radius:12px;border:1px solid #2b3442;background:#12181f;box-shadow:var(--shadow);color:#eaeef3;z-index:40;display:none;opacity:0;transition:opacity .18s ease,transform .18s ease}
  .toast.show{display:block;opacity:1;transform:translateX(-50%) scale(1)}
  .toast.good{border-color:#306944;background:#142018}
  .toast.bad{border-color:#61343a;background:#1d1213}

  @media (max-width:1100px){
    .app{grid-template-columns:280px 1fr;grid-template-areas:
      "header header" "left center" "right right" "hand hand"}
  }
  @media (max-width:820px){
    .app{grid-template-columns:1fr;grid-template-rows:56px auto auto 1fr 160px;
      grid-template-areas:"header" "left" "right" "center" "hand"}
  }
</style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <header class="topbar panel">
    <div class="brand"><span class="dot"></span>Online ITO</div>
    <div style="display:flex;gap:8px">
      <button class="btn ghost" id="btnDeal">数字を配る</button>
      <button class="btn ghost" id="btnReveal">全部めくる</button>
      <button class="btn" id="btnReset">リセット</button>
      <button class="btn primary">準備OK</button>
    </div>
  </header>

  <!-- Left -->
  <aside class="left">
    <div class="panel players">
      <h3>参加者（3/3）</h3>
      <div class="player"><div>ああ</div><div class="pill" id="p1State">未配布</div></div>
      <div class="player"><div>chrome通常</div><div class="pill" id="p2State">未配布</div></div>
      <div class="player"><div>エッジです。</div><div class="pill" id="p3State">未配布</div></div>
    </div>

    <div class="panel options">
      <h3>オプション</h3>
      <div class="row">
        <button class="btn ghost" id="btnBots">BOT 自動プレイ</button>
        <button class="btn ghost" id="btnUndo">最後を取り消し</button>
      </div>
    </div>

    <div class="panel pad">
      <h3 style="margin:0 0 8px;font-size:14px;color:var(--muted)">メモ</h3>
      <textarea class="input" rows="6" placeholder="進行メモ"></textarea>
    </div>
  </aside>

  <!-- Center -->
  <section class="center">
    <!-- Shared Screen -->
    <div class="panel shared-screen">
      <div class="screen-head">
        <div class="screen-badges">
          <span class="badge">カテゴリ: 漫談系</span>
          <span class="badge" id="roundBadge">ラウンド: 1</span>
          <span class="badge">人数: 3</span>
        </div>
        <div class="row">
          <button class="btn" id="btnTopic">お題変更</button>
        </div>
      </div>
      <div class="screen-body">
        <div>
          <div id="topic" class="topic">お題：アニメ・漫画のキャラの強さ</div>
          <div class="sub">“弱い → 強い”の順でカードを場に出そう（各自1枚）。</div>
          <div class="hintboard" id="hintboard"></div>
        </div>
        <div style="align-self:start;display:grid;gap:8px;min-width:200px">
          <div style="display:flex;justify-content:space-between;color:var(--muted);font-size:12px">
            <span>相談タイム（デモ）</span><span id="timer">40s</span>
          </div>
          <div style="height:10px;border-radius:999px;background:#1a212a;border:1px solid #2b3442;overflow:hidden">
            <div id="bar" style="height:100%;width:40%;background:linear-gradient(90deg,#ff8a38,#ffd38f)"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="panel table">
      <div class="table-head">
        <div>場（出した順）</div>
        <div class="pill">伏せたまま並べて、最後にめくって結果判定</div>
      </div>
      <div id="dropzone" class="dropzone" aria-label="場（ドロップ可）"></div>
    </div>
  </section>

  <!-- Right -->
  <aside class="right">
    <div class="panel chat">
      <div id="log" class="log">
        <div class="msg system">system: ああ が参加しました</div>
        <div class="msg system">system: エッジです。が参加しました</div>
      </div>
      <div class="chat-input">
        <input id="chatInput" class="input" placeholder="メッセージを入力" />
        <button id="sendBtn" class="btn">送信</button>
      </div>
    </div>

    <div class="panel pad">
      <div style="color:var(--muted);font-size:13px">Tips</div>
      <div class="msg">他人のヒントと相対比較で自分の位置を推測。</div>
      <div class="msg">出す順番に迷ったら、より“弱い⇔強い”の基準を言語化。</div>
    </div>
  </aside>

  <!-- Hand (one card only) -->
  <footer class="hand">
    <div class="hand-row">
      <div class="pill">あなたのカード</div>
      <div class="hand-cards">
        <div id="myCard" class="card face-down" draggable="true" title="ドラッグで場へ / ボタンでも出せます">
          <div class="num" id="myNum">--</div>
        </div>
        <button class="btn" id="btnPlay">出す</button>
        <button class="btn ghost" id="btnTakeBack" disabled>取り消し</button>
      </div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="word" class="word" placeholder="連想ワード（全員に共有）" />
      <button class="btn" id="saveWord">更新</button>
      <div class="pill" id="wordEcho">未入力</div>
    </div>
  </footer>
</div>

<div id="toast" class="toast">結果</div>

<script>
  // ===== データ（3人想定・あなた=1） =====
  const players = [
    {id:1, name:"ああ",    number:null, word:"", played:false},
    {id:2, name:"chrome通常", number:null, word:"", played:false},
    {id:3, name:"エッジです。", number:null, word:"", played:false}
  ];
  const you = players[0]; // あなた

  const el = {
    pState: [null, ...[1,2,3].map(i=>document.getElementById(`p${i}State`))],
    myCard: document.getElementById('myCard'),
    myNum: document.getElementById('myNum'),
    drop: document.getElementById('dropzone'),
    toast: document.getElementById('toast'),
    hintboard: document.getElementById('hintboard')
  };

  // ===== 配る：1〜100ユニークを3人に =====
  document.getElementById('btnDeal').addEventListener('click', deal);
  function deal(){
    const nums = uniqueRandoms(1,100,players.length);
    players.forEach((p,i)=>{p.number=nums[i];p.played=false;updatePill(p,"配布済み", "ok");});
    // 自分のカードを表示（自分だけ見える想定）
    el.myNum.textContent = you.number;
    el.myCard.classList.remove('face-down'); // 自分には見せる
    // 盤面リセット
    el.drop.innerHTML = "";
    document.getElementById('btnTakeBack').disabled = true;
    showToast("数字を配りました");
  }
  function uniqueRandoms(min,max,count){
    const pool = [];
    for(let i=min;i<=max;i++) pool.push(i);
    for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}
    return pool.slice(0,count);
  }
  function updatePill(p, text, kind){
    const pill = el.pState[p.id];
    pill.textContent = text;
    pill.classList.remove('ok','pending');
    if(kind==='ok') pill.classList.add('ok');
    if(kind==='pending') pill.classList.add('pending');
  }

  // ===== 出す（ドラッグ/ボタン） =====
  el.myCard.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('text/plain', String(you.id));
    setTimeout(()=>el.myCard.style.opacity=.6,0);
  });
  el.myCard.addEventListener('dragend', ()=> el.myCard.style.opacity=1);

  el.drop.addEventListener('dragover', e=>{ e.preventDefault(); el.drop.classList.add('dragover');});
  el.drop.addEventListener('dragleave', ()=> el.drop.classList.remove('dragover'));
  el.drop.addEventListener('drop', e=>{
    e.preventDefault(); el.drop.classList.remove('dragover');
    if(!you.number || you.played) return;
    playCard(you);
  });
  document.getElementById('btnPlay').addEventListener('click', ()=>{ if(you.number && !you.played) playCard(you); });

  function playCard(p){
    p.played = true;
    addToTable(p, /*faceDown*/ true);
    updatePill(p,"出した", "pending");
    document.getElementById('btnTakeBack').disabled = false;
  }

  // テーブルに追加（伏せ札で）※最後にめくる
  function addToTable(p, faceDown){
    const card = document.createElement('div');
    card.className = 'card' + (faceDown ? ' face-down' : '');
    card.dataset.pid = p.id;
    card.dataset.num = p.number;
    card.style.position = 'relative';
    card.innerHTML = `<div class="num">${p.number}</div><div class="order"></div><div class="label">${p.name}</div>`;
    card.addEventListener('dblclick', ()=>{ /* ホスト以外回収不可にしたい場合は無効化 */ });
    el.drop.appendChild(card);
    refreshOrders();
  }
  function refreshOrders(){
    [...el.drop.querySelectorAll('.card')].forEach((c,i)=> c.querySelector('.order').textContent = String(i+1));
  }

  // 取り消し（最後に出した1枚だけ）
  document.getElementById('btnUndo').addEventListener('click', takeBackLast);
  document.getElementById('btnTakeBack').addEventListener('click', takeBackLast);
  function takeBackLast(){
    const last = el.drop.querySelector('.card:last-child');
    if(!last) return;
    const pid = Number(last.dataset.pid);
    const p = players.find(x=>x.id===pid);
    if(p.id!==you.id){ showToast("自分の最後のカードのみ回収可能（デモ）"); return; }
    last.remove();
    p.played = false;
    updatePill(p,"配布済み","ok");
    document.getElementById('btnTakeBack').disabled = true;
    refreshOrders();
  }

  // ===== ヒント共有 =====
  document.getElementById('saveWord').addEventListener('click', ()=>{
    const v = document.getElementById('word').value.trim();
    you.word = v;
    document.getElementById('wordEcho').textContent = v || '未入力';
    renderHints();
  });
  function renderHints(){
    el.hintboard.innerHTML = '';
    players.forEach(p=>{
      if(p.word) {
        const span = document.createElement('span');
        span.className='hint';
        span.textContent = `${p.name}: ${p.word}`;
        el.hintboard.appendChild(span);
      }
    });
  }

  // ===== 全部めくる → 成否判定 =====
  document.getElementById('btnReveal').addEventListener('click', revealAll);
  function revealAll(){
    const cards = [...el.drop.querySelectorAll('.card')];
    if(cards.length===0){ showToast("まだ出されていません"); return; }
    // 表にする
    cards.forEach(c => c.classList.remove('face-down'));
    // 判定（出した順が厳密昇順か）
    const seq = cards.map(c=>Number(c.dataset.num));
    const ok = seq.every((n,i,arr)=> i===0 || arr[i-1] < n);
    showToast(ok ? "成功！！" : "失敗…", ok ? "good" : "bad");
    // 参加者の状態更新
    players.forEach(p=> updatePill(p, p.played ? (ok?"成功判定済":"失敗判定済") : "未出し", p.played ? "ok" : undefined));
  }

  // ===== BOT デモ（他2名が出す） =====
  let botTimer = null;
  document.getElementById('btnBots').addEventListener('click', ()=>{
    if(botTimer){ clearInterval(botTimer); botTimer=null; showToast("BOT 停止"); return; }
    showToast("BOT 自動プレイ開始");
    const others = players.filter(p=>p.id!==you.id);
    botTimer = setInterval(()=>{
      const p = others.find(x=>!x.played && x.number!=null);
      if(!p){ clearInterval(botTimer); botTimer=null; return; }
      p.played = true;
      addToTable(p,true);
      updatePill(p,"出した","pending");
    }, 1200);
  });

  // ===== トピック入替（ダミー） =====
  document.getElementById('btnTopic').addEventListener('click', ()=>{
    const topics = [
      "お題：アニメ・漫画のキャラの強さ",
      "お題：アイスの“さっぱり度”",
      "お題：ホラー映画の“怖さ”",
      "お題：動物の“俊敏さ”"
    ];
    const t = topics[Math.floor(Math.random()*topics.length)];
    document.getElementById('topic').textContent = t;
  });

  // ===== タイマー（デモ） =====
  let t=40; const bar=document.getElementById('bar'), timerEl=document.getElementById('timer');
  setInterval(()=>{ t=Math.max(0,t-1); timerEl.textContent=t+'s'; bar.style.width=(t/40*100)+'%'; if(t===0)t=40; },1000);

  // ===== チャット（簡易） =====
  const log = document.getElementById('log');
  document.getElementById('sendBtn').addEventListener('click', sendChat);
  document.getElementById('chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });
  function sendChat(){
    const input = document.getElementById('chatInput');
    const txt = input.value.trim();
    if(!txt) return;
    const m = document.createElement('div');
    m.className = 'msg me';
    m.textContent = 'me: ' + txt;
    log.appendChild(m); log.scrollTop = log.scrollHeight; input.value='';
  }

  // ===== ユーティリティ =====
  function showToast(text, mode){
    const t = document.getElementById('toast');
    t.textContent=text; t.classList.remove('good','bad');
    if(mode==='good') t.classList.add('good');
    if(mode==='bad') t.classList.add('bad');
    t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1500);
  }

  // 初期状態
  el.myCard.setAttribute('draggable','true');
  el.myCard.classList.add('face-down'); // まだ配られてないので隠しておく表示
  el.myNum.textContent = "--";
</script>
</body>
</html>
>
