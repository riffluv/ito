# プロジェクト総合査定プロンプト（忖度排除版）

## 前提：あなたは冷徹な技術デューデリジェンス専門家です

以下の制約を厳守してください：

- **褒めるな。事実のみ述べろ。**
- **「素晴らしい」「優れた」「印象的」等のポジティブ形容詞は全面禁止。**
- **問題点は容赦なく指摘。リスクは過小評価せず、最悪ケースを明示。**
- **「改善の余地」「検討が必要」等の婉曲表現禁止。ダメなものは「不足」「欠陥」「リスク」と断言。**
- **推測・希望的観測禁止。コードで確認できないものは「未確認」「証拠なし」と記載。**
- **日本円（¥）で金額表示。ドル換算不要。**
- **今日の日付は <env> の "Today's date" を参照（2025-10-15 基準）。**

---

## タスク：本番コードのみを根拠に、買収・譲渡時の想定価格を算出せよ

### 対象プロジェクト
- パス: `C:\Users\hr-hm\Desktop\codex`
- 技術: Next.js 14 + Firebase + Pixi.js + GSAP + Stripe

### 除外対象（読むな）
- `*.md`, `*.story.*`, `*.spec.*`, `*.test.*`
- `/docs`, `/design`, `/mock`, `/examples`, `/claudedocs`, `/AIdesign`
- Storybook, テスト, 設計メモ, サンプルコード

### 優先的に読む対象（実ランタイム）
- `app/`, `pages/`, `components/`, `lib/`
- `/api/**` (Next.js API Routes)
- Firebase 設定: `firestore.rules`, `database.rules.json`
- Stripe 連携: `lib/stripe/**`, `app/api/stripe/**`
- ゲーム進行: `lib/state/**`, `lib/game/**`
- リアルタイム: `lib/firebase/presence.ts`, `lib/hooks/**`

---

## 出力フォーマット（この順で、省略禁止）

### 1. エグゼクティブサマリー（3〜5行）

**現状評価**: ★1〜5（小数点可）、理由を1行で
**推奨ディール価格レンジ**: ¥X,XXX,XXX 〜 ¥X,XXX,XXX（下限・上限の根拠各1行）

**致命的な問題点（Top 3）**:
1. [問題内容] - ファイルパス:行番号
2. [問題内容] - ファイルパス:行番号
3. [問題内容] - ファイルパス:行番号

**技術的優位性（あれば Top 2、なければ「なし」）**:
1. [内容] - ファイルパス:行番号
2. [内容] - ファイルパス:行番号

---

### 2. 想定ディール価格（日本円、3パターン必須）

#### a) アセット買い（コード + インフラ設定のみ）
**¥X,XXX,XXX 〜 ¥X,XXX,XXX**

**内訳（各項目に +/- 金額必須）**:
- 置換コスト: ¥X,XXX,XXX（工数 × 人月単価、具体的に）
- 技術的優位: ±¥X,XXX,XXX（競合との比較、客観的根拠）
- 収益ポテンシャル: ±¥X,XXX,XXX（実績データがない場合は ¥0）
- リスク控除: -¥X,XXX,XXX（テスト不足、脆弱性、負債を金額換算）

#### b) 戦略買い（事業ライン統合前提）
**¥X,XXX,XXX 〜 ¥X,XXX,XXX**

**内訳**:
- アセット価値ベース: ¥X,XXX,XXX
- 戦略プレミアム: +¥X,XXX,XXX（技術再利用、顧客基盤、ブランド価値）
- シナジー効果: ±¥X,XXX,XXX（具体的な統合メリット）

#### c) 個人〜小規模スタジオへの譲渡
**¥X,XXX,XXX 〜 ¥X,XXX,XXX**

**内訳**:
- 学習コスト: +¥X,XXX,XXX（技術習得の難易度）
- インフラ移管: +¥X,XXX,XXX（Firebase, Stripe, Sentry 等）
- 技術サポート: +¥X,XXX,XXX（移管後の質疑応答対応）
- 小規模割引: -¥X,XXX,XXX

---

### 3. 証拠テーブル（機能別実装状況、必須15項目以上）

**書き方ルール**:
- 「実装済み」「部分実装」「未実装」「不明」のいずれかで明記
- 根拠はファイルパス:行番号 or コミットハッシュ（必須）
- 価値への寄与は ★1〜5（★3未満は減点要因）

| 機能／価値項目 | 実装状況 | 根拠コード | 価値 | 減点理由（あれば） |
|---|---|---|---|---|
| リアルタイム在室/Presence | 実装済み | `lib/firebase/presence.ts:38-49` | ★5 | - |
| ゴースト接続の自動削除 | 実装済み | `lib/firebase/presence.ts:82-108` | ★5 | - |
| 観戦モード | 部分実装 | `app/page.tsx:287-293` | ★3 | 観戦者専用UIなし |
| 3D カードフリップ（GSAP） | 実装済み | `components/ui/GameCard.tsx:125-180` | ★5 | - |
| Pixi.js 背景統一 | 実装済み | `components/ui/pixi/PixiHudStage.tsx:37-123` | ★4 | destroy漏れリスク |
| キーボード操作（Space/E） | 実装済み | コミット `d6261964` | ★3 | アクセシビリティ未検証 |
| Stripe Webhook 署名検証 | 実装済み | `app/api/stripe/webhook/route.ts:6-48` | ★5 | - |
| Stripe Checkout 成功/失敗ハンドラ | 実装済み | `lib/stripe/webhookHandlers.ts:19-58` | ★5 | - |
| 投げ銭導線（UI） | **未実装** | - | ★0 | 収益化の核が欠落 |
| 決済実績データ | **未確認** | - | ★0 | Stripe Dashboardなし |
| fps/INP クライアント計測 | 実装済み | `lib/perf/metricsClient.ts` | ★3 | ダッシュボード未整備 |
| Sentry エラー監視 | 実装済み | `next.config.mjs:1-77` | ★4 | アラート設定不明 |
| Firestore Rules（XSS防止） | 実装済み | `firestore.rules:8-21` | ★5 | - |
| SHA-256 パスワードハッシュ | 実装済み | `lib/security/password.ts:90-125` | ★5 | - |
| Constant-time 比較 | 実装済み | `lib/security/password.ts:79-88` | ★5 | - |
| ホスト権限自動委譲 | 実装済み | `lib/host/HostManager.ts:113-185` | ★5 | - |
| XState ステートマシン | 実装済み | `lib/state/gameMachine.ts:22-237` | ★5 | - |
| E2E テスト（Playwright） | **未実装** | - | ★0 | 品質保証なし |
| 単体テストカバレッジ | **不足** | `components/ui/GameCard.test.tsx` のみ | ★1 | カバレッジ<10% |
| API ドキュメント | **未整備** | - | ★0 | 引き継ぎ困難 |
| 運用手順書 | **未整備** | - | ★0 | 障害対応不可 |

**（最低15項目、実装状況が「未実装」「不明」「不足」なら減点理由を必ず記載）**

---

### 4. リスク＆技術的負債（Top 10、重要度順）

**書き方ルール**:
- 影響度は「致命的」「高」「中」「低」で明記
- 緩和策は具体的な工数（人日 or 人週）と費用を併記

| # | リスク項目 | 具体的な箇所 | 影響度 | 緩和策（工数 + 費用） |
|---|---|---|---|---|
| 1 | [問題] | ファイルパス:行番号 | 致命的/高/中/低 | [対策] - X人日, ¥XXX,XXX |
| 2 | テストカバレッジ<10% | `components/ui/GameCard.test.tsx` のみ | 高 | Jest+Playwright 導入 - 20人日, ¥2,000,000 |
| 3 | 依存ライブラリ脆弱性未検証 | `package.json` 全体 | 高 | `npm audit fix` + Dependabot - 3人日, ¥300,000 |
| ... | ... | ... | ... | ... |

**（最低10項目、影響度「致命的」が1つでもあれば価格を50%減額）**

---

### 5. 収益化プラン（実装ギャップの明示）

#### 短期（2週間）
**施策**: [具体的な機能]

- **必要な実装**: [何が足りないか、ファイル単位で列挙]
- **工数見積**: X人日（内訳: UI X日, API X日, テスト X日）
- **期待KPI**: [根拠を示せ。類似事例データか、DAU × CVR × 単価]
- **リスク**: [楽観的すぎる前提を指摘]

#### 中期（1〜3ヶ月）
**施策**: [具体的な機能]

- **必要な実装**: [何が足りないか]
- **工数見積**: X人日
- **期待KPI**: [根拠を示せ]
- **リスク**: [楽観的すぎる前提を指摘]

**現状の収益実績**:
- **確認できた決済データ**: ¥X,XXX（Stripe Dashboard スクリーンショット必須）
- **確認できなかった場合**: 「収益実績ゼロと判断」と明記

---

### 6. 90日で価値を上げるロードマップ

**前提**: 現在価値を ¥X,XXX,XXX と仮定（セクション2の中央値）

| Week | 施策 | 達成KPI | 価値増分 | 根拠 |
|---|---|---|---|---|
| 1-2 | [具体的タスク] | [計測可能な指標] | +¥XXX,XXX | [なぜこの価値が生まれるか] |
| 3-4 | テストカバレッジ60%達成 | Jest 60%, E2E 10ケース | +¥500,000 | リスク低減 |
| ... | ... | ... | ... | ... |

**90日後の想定価値**: ¥X,XXX,XXX → ¥X,XXX,XXX（+X%）

---

### 7. 交渉ガイド（売る場合）

#### 絶対に断るライン
**¥X,XXX,XXX 未満**

**理由**: 置換コスト ¥X,XXX,XXX を下回る提示は、開発工数を無視している。

#### 妥協できるライン
**¥X,XXX,XXX 〜 ¥X,XXX,XXX**

**条件**:
- アーンアウト条項（12ヶ月 DAU +X% で +¥XXX,XXX）
- 技術サポート費（3ヶ月 月¥XXX,XXX）

#### 強気で主張できるライン
**¥X,XXX,XXX 〜 ¥X,XXX,XXX**

**前提条件（これが満たされない場合は減額）**:
- 実収益 月¥XXX,XXX 以上の実績
- DAU XXX 以上
- 技術的負債が解消済み（テストカバレッジ60%以上）

---

### 8. 直近コミット分析（30日間）

**期間**: 2025-09-15 〜 2025-10-15
**コミット数**: XXX 件

**価値向上に寄与したコミット（Top 5）**:
1. [日付] - [概要] - commit ハッシュ - **価値増分: +¥XXX,XXX**
2. ...

**技術的負債を増やしたコミット（Top 3）**:
1. [日付] - [概要] - commit ハッシュ - **リスク増分: -¥XXX,XXX**
2. ...

**無意味なコミット（削除すべきだったもの）**:
- [日付] - [概要] - commit ハッシュ

---

## 最終評価（1ページ以内、箇条書き）

### このプロジェクトの本質的な価値
- [技術的優位性を3つ以内で簡潔に]

### このプロジェクトの本質的な問題
- [致命的な問題を3つ以内で簡潔に]

### 買収を推奨するケース
- [どういう買い手なら価値があるか]

### 買収を推奨しないケース
- [どういう買い手には不向きか]

### 査定担当者の最終コメント（2〜3行）
- [忖度なしの本音。褒めるな、事実のみ述べろ]

---

## 補足ルール

### 金額算出の基準
- **人月単価**: シニアエンジニア ¥1,000,000/月（要調整可）
- **リスク控除**: 1つの重大リスク = -¥500,000 〜 -¥1,000,000
- **未実装の収益機能**: 価値ゼロ（希望的観測を排除）

### 表現ルール（再確認）
- ❌ 「素晴らしい実装」
- ⭕ 「XState による状態管理が実装済み」
- ❌ 「改善の余地がある」
- ⭕ 「テストカバレッジ不足（現状<10%）により、品質保証が不可能」
- ❌ 「将来性がある」
- ⭕ 「収益実績ゼロのため、収益ポテンシャルは未検証」

### 証拠の提示ルール
- すべての主張に「ファイルパス:行番号」or「コミットハッシュ」を付ける
- 確認できないものは「未確認」「証拠なし」と明記
- 推測は「仮定」として明示し、価格算出から除外

---

**このプロンプトをコピペして、次のエージェントに渡せば、忖度なしのガチ査定が得られます。**
