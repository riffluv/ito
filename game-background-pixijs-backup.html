<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€ä¿å­˜ç‰ˆã€‘ã‚²ãƒ¼ãƒ èƒŒæ™¯ - Octopath Traveleré¢¨ HD-2D Pixi.js</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0E0F13;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #pixiCanvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 12px;
            font-size: 14px;
            z-index: 100;
            border: 2px solid #FFD700;
        }

        .controls h3 {
            margin: 0 0 15px 0;
            color: #FFD700;
            text-shadow: 0 0 8px #FFD700;
        }

        .controls p {
            margin: 8px 0;
            line-height: 1.4;
        }

        .backup-notice {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            background: rgba(255, 215, 0, 0.9);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 100;
            font-weight: bold;
            color: #000;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .feature-list {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 100;
            max-width: 300px;
        }

        .feature-list h4 {
            margin: 0 0 10px 0;
            color: #FFD700;
        }

        .feature-list ul {
            margin: 0;
            padding-left: 20px;
        }

        .feature-list li {
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>ğŸ® Octopath Traveleré¢¨ HD-2DèƒŒæ™¯</h3>
        <p><strong>ãƒ‰ãƒ©ã‚¯ã‚¨é¢¨ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ç”¨</strong></p>
        <p>âœ¨ æµ®éŠã™ã‚‹é‡‘è‰²ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«</p>
        <p>ğŸ”ï¸ å¥¥è¡Œãã‚ã‚‹å±±ã€…ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆ</p>
        <p>ğŸŒ¿ å¯æ„›ã„è‰åŸã®å‰æ™¯</p>
        <p>ğŸ’« ãªã‚ã‚‰ã‹ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</p>
    </div>

    <div class="backup-notice">
        ğŸ’¾ ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚²ãƒ¼ãƒ èƒŒæ™¯ä¿å­˜ç‰ˆ
    </div>

    <div class="feature-list">
        <h4>å®Ÿè£…æ©Ÿèƒ½</h4>
        <ul>
            <li>HD-2Dã‚¹ã‚¿ã‚¤ãƒ«ã®æ·±åº¦è¡¨ç¾</li>
            <li>é‡‘è‰²ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆ30å€‹ï¼‰</li>
            <li>ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ</li>
            <li>60FPSæœ€é©åŒ–</li>
            <li>ãƒ‰ãƒ©ã‚¯ã‚¨ãƒ†ãƒ¼ãƒè‰²å½©</li>
            <li>ãªã‚ã‚‰ã‹ãªåœ°å½¢ã‚«ãƒ¼ãƒ–</li>
        </ul>
    </div>

    <!-- Pixi.js CDN (v8å¯¾å¿œ) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/8.0.0/pixi.min.js"></script>

    <script>
        console.log('ğŸ® ã‚²ãƒ¼ãƒ èƒŒæ™¯ Pixi.js (Octopathé¢¨) èµ·å‹•é–‹å§‹...');

        let app = null;
        let frameId = null;

        const initPixi = async () => {
            try {
                // PixiJS v8å¯¾å¿œ: æ­£ã—ã„init()æ–¹æ³•
                app = new PIXI.Application();
                await app.init({
                    width: window.innerWidth,
                    height: window.innerHeight,
                    backgroundColor: 0x0E0F13, // ãƒ†ãƒ¼ãƒçµ±ä¸€ï¼ˆ16é€²æ•°ã§æŒ‡å®šï¼‰
                    antialias: true,
                    resolution: Math.min(2, window.devicePixelRatio || 1),
                    autoDensity: true,
                });

                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’DOMã«è¿½åŠ 
                app.canvas.id = 'pixiCanvas';
                document.body.appendChild(app.canvas);
                console.log('ğŸ“± ã‚­ãƒ£ãƒ³ãƒã‚¹è¿½åŠ å®Œäº†');

                // === Octopath Traveleré¢¨HD-2Dè¦ç´  ===

                // 1. å¥¥è¡Œãã®ã‚ã‚‹èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¤§åœ°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
                const bgGradient = new PIXI.Graphics();
                bgGradient.rect(0, 0, app.screen.width, app.screen.height);
                bgGradient.fill({
                    color: 0x1a1b2e,
                    alpha: 1,
                });
                app.stage.addChild(bgGradient);
                console.log('ğŸ¨ èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ');

                // 2. é æ™¯ã®å±±ã€…ï¼ˆã‚·ãƒ«ã‚¨ãƒƒãƒˆï¼‰
                const mountains = new PIXI.Graphics();
                mountains.moveTo(0, app.screen.height * 0.7);
                for (let i = 0; i <= app.screen.width; i += 100) {
                    const height = app.screen.height * (0.7 + Math.sin(i * 0.01) * 0.15);
                    mountains.lineTo(i, height);
                }
                mountains.lineTo(app.screen.width, app.screen.height);
                mountains.lineTo(0, app.screen.height);
                mountains.fill({
                    color: 0x2d1b4e,
                    alpha: 0.8,
                });
                app.stage.addChild(mountains);
                console.log('ğŸ”ï¸ å±±ã€…ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆä½œæˆ');

                // 3. æµ®éŠã™ã‚‹å…‰ã®ç²’å­ï¼ˆãƒ‰ãƒ©ã‚¯ã‚¨é¢¨ãƒã‚¸ãƒƒã‚¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰
                const particles = [];

                // å®‰å…¨ãªè‰²ã®é…åˆ—ï¼ˆãƒ‰ãƒ©ã‚¯ã‚¨é¢¨ã®é‡‘è‰²ç³»ï¼‰
                const safeColors = [
                    0xffd700, // é‡‘è‰²
                    0xffdc00, // æ˜ã‚‹ã„é‡‘è‰²
                    0xffc700, // æ¿ƒã„é‡‘è‰²
                    0xffed4a, // é»„é‡‘è‰²
                    0xfff176, // ãƒ©ã‚¤ãƒˆã‚´ãƒ¼ãƒ«ãƒ‰
                    0xffb300, // ã‚ªãƒ¬ãƒ³ã‚¸ã‚´ãƒ¼ãƒ«ãƒ‰
                ];

                for (let i = 0; i < 30; i++) {
                    const particle = new PIXI.Graphics();
                    particle.circle(0, 0, Math.random() * 2 + 1);
                    particle.fill({
                        color: safeColors[Math.floor(Math.random() * safeColors.length)],
                        alpha: Math.random() * 0.6 + 0.2,
                    });

                    particle.x = Math.random() * app.screen.width;
                    particle.y = Math.random() * app.screen.height;

                    const particleData = {
                        particle,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.3,
                        life: Math.random() * 2 + 1,
                    };

                    particles.push(particleData);
                    app.stage.addChild(particle);
                }
                console.log('âœ¨ é‡‘è‰²ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«30å€‹ä½œæˆ');

                // 4. å¯æ„›ã„å‰æ™¯ã®è‰åŸï¼ˆãªã‚ã‚‰ã‹ãªæ›²ç·šï¼‰
                const foreground = new PIXI.Graphics();
                const grassY = app.screen.height * 0.87;

                // ãªã‚ã‚‰ã‹ãªæ³¢å½¢ã®è‰åŸï¼ˆç›´ç·šã˜ã‚ƒãªã„ã€ã§ã‚‚ãƒœã‚³ãƒœã‚³ã—ã™ããªã„ï¼‰
                foreground.moveTo(0, grassY);
                for (let i = 0; i <= app.screen.width; i += 30) {
                    const gentleWave = Math.sin(i * 0.008) * 12 + grassY;
                    foreground.lineTo(i, gentleWave);
                }
                foreground.lineTo(app.screen.width, app.screen.height);
                foreground.lineTo(0, app.screen.height);
                foreground.fill({
                    color: 0x2d5940, // è½ã¡ç€ã„ãŸæ·±ç·‘
                    alpha: 0.8,
                });
                app.stage.addChild(foreground);

                // å¯æ„›ã„å°ã•ãªè‰ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼ˆå°‘ãªã‚ï¼‰
                for (let i = 0; i < 15; i++) {
                    const grassAccent = new PIXI.Graphics();
                    const x = Math.random() * app.screen.width;
                    const y = app.screen.height * (0.88 + Math.random() * 0.08);
                    const size = Math.random() * 1.5 + 0.8;

                    grassAccent.circle(x, y, size);
                    grassAccent.fill({
                        color: 0x4a7c59, // æ˜ã‚‹ã‚ã®ç·‘
                        alpha: 0.7,
                    });
                    app.stage.addChild(grassAccent);
                }
                console.log('ğŸŒ¿ è‰åŸã®å‰æ™¯ä½œæˆ');

                // 5. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ— - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç‰ˆ
                let lastTime = 0;
                const targetFPS = 60;
                const frameInterval = 1000 / targetFPS;

                const animate = (currentTime) => {
                    // ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆèª¿æ•´
                    if (currentTime - lastTime < frameInterval) {
                        frameId = requestAnimationFrame(animate);
                        return;
                    }
                    lastTime = currentTime;

                    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒç ´æ£„ã•ã‚Œã¦ã„ãŸã‚‰åœæ­¢
                    if (!app || !app.stage) {
                        return;
                    }

                    // å…‰ã®ç²’å­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    particles.forEach(data => {
                        const { particle, vx, vy, life } = data;
                        particle.x += vx;
                        particle.y += vy;

                        // ç”»é¢å¤–ã«å‡ºãŸã‚‰åå¯¾å´ã‹ã‚‰å†å‡ºç¾
                        if (particle.x > app.screen.width) particle.x = -10;
                        if (particle.x < -10) particle.x = app.screen.width;
                        if (particle.y > app.screen.height) particle.y = -10;
                        if (particle.y < -10) particle.y = app.screen.height;

                        // æ˜æ»…åŠ¹æœï¼ˆæœ€é©åŒ–æ¸ˆã¿ï¼‰
                        particle.alpha = Math.sin(currentTime * 0.001 * life) * 0.3 + 0.4;
                    });

                    frameId = requestAnimationFrame(animate);
                };

                animate(performance.now());
                console.log('ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹');

            } catch (error) {
                console.error('âŒ Pixi.jsåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);

                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èƒŒæ™¯ã‚’è¡¨ç¤º
                document.body.style.backgroundColor = '#0E0F13';

                // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    color: #fff;
                    background: rgba(255, 0, 0, 0.8);
                    padding: 20px;
                    border-radius: 8px;
                    text-align: center;
                    z-index: 1000;
                `;
                errorDiv.innerHTML = `
                    <h3>âš ï¸ èƒŒæ™¯åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h3>
                    <p>ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èƒŒæ™¯ã‚’è¡¨ç¤ºä¸­</p>
                `;
                document.body.appendChild(errorDiv);

                if (app && app.stage) {
                    try {
                        app.destroy();
                    } catch (e) {
                        // ç ´æ£„ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–
                    }
                }
                app = null;
            }
        };

        // åˆæœŸåŒ–å®Ÿè¡Œ
        initPixi();

        // ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ - PixiJS v8å¯¾å¿œ
        const handleResize = () => {
            try {
                if (app && app.stage && app.renderer) {
                    app.renderer.resize(window.innerWidth, window.innerHeight);
                    console.log('ğŸ“ ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ');
                }
            } catch (error) {
                console.warn('âš ï¸ ãƒªã‚µã‚¤ã‚ºã‚¨ãƒ©ãƒ¼:', error);
            }
        };

        window.addEventListener('resize', handleResize);

        // ãƒšãƒ¼ã‚¸ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (frameId) {
                cancelAnimationFrame(frameId);
            }
            if (app && app.stage) {
                try {
                    app.destroy();
                    console.log('ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                } catch (e) {
                    console.warn('âš ï¸ ç ´æ£„ã‚¨ãƒ©ãƒ¼:', e);
                }
            }
        });

        console.log('ğŸ® ã‚²ãƒ¼ãƒ èƒŒæ™¯ Pixi.js (ä¿å­˜ç‰ˆ) èµ·å‹•å®Œäº†ï¼');
    </script>
</body>
</html>