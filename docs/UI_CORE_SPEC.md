# 序の紋章III：UI Core Spec（AI感 / Web感 排除）

Version: v1 (2025-12-29)

---

## 0. この資料の使い方（毎回この流れで依頼する）

デザイン実装を AI（Codex / Claude Code など）に依頼するときは、**必ずこのファイルを提示**して「この仕様に従って実装して」と伝える。

推奨フロー:

1. 実装担当 AI にまず読ませる（MUST）
   - `docs/UI_CORE_SPEC.md`（本資料 / 骨格）
   - `STYLE_GUIDE.md`（tokens-first / レイアウト定数などの運用ルール）
   - `theme/DESIGN_GUIDE.md`（Chakra v3 の recipes / tokens 設計方針）
2. テーマが必要なら “テーマパック” を 1つだけ指定（OPTION）
   - 例: `docs/ui_theme/hd2d_pack.md`
3. 対象範囲を指定（例: ボタン / パネル / モーダル / トースト / 入力）
4. 変更の性質を指定
   - 原則: **tokens/recipes（見た目の集中管理）で直す**
   - レイアウト変更・文言変更を含めるなら明示
5. 実装後に確認
   - PC（Chrome）とモバイル（Android Chrome）で見た目・押し心地
   - `npm run typecheck`、該当 Playwright を最小本数で実行（必要時）

---

## 1. ゴール / 非ゴール

### ゴール

- 「Webアプリっぽい UI」をやめ、**据え置きゲーム（コンシューマ）っぽい手触り・見た目**に寄せる。
- 世界観（見た目・素材感）は “テーマパック” として差し替え可能にし、**骨格（操作感/状態/階層）を固定**する。
- スマホでも破綻しない（タップ領域、safe-area、reduced-motion）。

### 非ゴール（Core Spec 単体ではやらないこと）

- 背景アートの刷新、Pixi 背景/HUDの大改造。
- 画面遷移やゲームロジックの変更（UI設計と分離）。
- “派手さ” のための常時グロー・常時アニメ（AI感/安っぽさの原因になりやすい）。

---

## 2. 大原則（4本柱）

1. **物体化（face / rim / bevel / cast）**  
   フラットな塗り＋薄い影ではなく、板の厚みとして説得力を作る。
2. **状態は「色」より「線と段差」**  
   hover/pressed/selected/disabled/loading/locked/focus を、線の本数・太さ・沈みで判別できるようにする（色だけ禁止）。
3. **フォーカスが主役（focus-visible 二重リング）**  
   据え置き感は将来のゲームパッド風フォーカス移動にも直結する。
4. **階層は枠の段数で分かる**  
   HUD（薄い）/ 窓（標準）/ モーダル（最強）を、枠と段差で一目で分かるようにする。

---

## 3. 「Webっぽさ」→「据え置きゲームっぽさ」決定的差分（要点10）

1. **フラット面 → 物体（上面＋段縁＋側面＋接地）**
2. **色変化中心 → 線と段差中心**（状態が物理で分かる）
3. **均一角丸 → 役割角（角丸は主役じゃない）**
4. **薄いブラー影 → 影は最小、代わりにベベル**
5. **hover前提 → focus-visible前提**
6. **Primary量産 → Primaryは1画面1つ**
7. **フォーム（Input素）→ 道具（凹み＋枠＋点灯）**
8. **SaaSトースト（右下）→ ゲーム通知（上寄せスタック）**
9. **スケールアニメ多用 → Zの手前化（枠/影/暗転）**
10. **均一余白 → 余白は階層（8/14/24）**

---

## 4. 中核仕様：ボタン（最重要）

### 4-1. 運用ルール

- Primary は原則「**1画面1つ**」（決定/提出/開始など）
- danger 操作は destructive に分離（Primary にしない）
- 状態は「色だけ禁止」（線/段差/沈み/パターン/アイコンを併用）

### 4-2. サイズ（見た目）とヒット領域（必須）

- ヒット領域（最小）: **44×44**（iOS指針相当）
- 推奨（Android Chrome 主戦場）: **48×48** へ寄せる
- “compact” 見た目を小さくしても、当たり判定は minH を維持（padding/透明hit領域で吸収）

例（目安）:

- Large: h=48, px=16, font=16（minH=48）
- Default: h=44, px=14, font=16（minH=44〜48）
- Compact: 見た目 h=36 でも **minH=44** を維持、font=14

### 4-3. 物理構造（CSSレイヤーの考え方）

ボタンは “板” として成立させる（1要素＋疑似要素でOK）。

- FACE: 微グラデ（単色ベタ塗り禁止寄り）
- RIM: 枠は2段以上（外枠＋内枠）
- BEVEL: inset の上ハイライト＋下影
- CAST: 接地影（短く、ブラー弱く）
- NOISE（任意）: 4〜6% の極薄ノイズ（やりすぎ禁止）

推奨の影スタック（例）:

- inset 上面ハイライト
- inset 下面の締まり
- 接地影（cast）

### 4-4. 押し込み（pressed）の規則

- pressed: `translateY(1px)`（沈む）
- pressed: 接地影は弱く（or 消す）、下面の inset 影を増やす

### 4-5. “決定の確定感”（クリックUP時）

目的: 「押した→確定した」が視覚だけで分かる（音頼みにしない）。

- 実装方法（例）: click確定時に短時間だけ `data-confirm="on"` を付ける（90〜120ms）
- 表現: 内枠が一瞬だけ明るくなる / 枠だけ点灯（スケール禁止、移動禁止）

### 4-6. 状態（必須セット）

- normal / hover（マウスのみ） / pressed / focus-visible / selected / disabled / loading / locked
- focus-visible: **二重リング（外2px＋内1px）**を統一（hover より格上）
- disabled: opacity で“消す”のではなく、影/ハイライトを消して“死んだ道具”にする
- loading: disabled相当だが、表示は維持（レイアウトが揺れない）
- locked: disabled＋（斜線パターン or 錠アイコン）※最大2要素ルール

### 4-7. pointer: coarse（スマホ）での注意

- hover 前提の演出を出さない（誤点灯・誤解を避ける）
- タップの体感は “沈む” と “確定フラッシュ” で作る

---

## 5. パネル/窓/モーダル/通知（ゲーム窓文法）

### 5-1. 階層を「枠段数」で固定する

- HUD（常時）: 1〜2段（細い）、背景は控えめ、邪魔しない
- メニュー窓（ログ/説明/設定）: **3段固定**
- モーダル（確認/エラー/復帰）: **4段固定**

区切りは 1px 線ではなく “溝” を基本にする（上暗1px + 下明1px の2px）。

### 5-2. モーダル演出：スケール禁止寄り

- 暗転（rgba(0,0,0,0.55) 目安）＋輪郭強化（枠/影/コントラスト）で「前に出す」
- ぽよん拡大（scale-in）を常用しない（Web感・酔いの原因）
- `prefers-reduced-motion: reduce` では移動/ズームを原則ゼロにする

### 5-3. トースト/通知：SaaS排除（上寄せスタック）

- 右下トーストは避ける
- 上中央〜右上にスタック（safe-area 考慮）
- 重要度で枠段数を変える（色だけ禁止）
  - Info: 2段枠（短時間）
  - Warning: 3段枠＋アイコン
  - Danger: 4段枠＋アイコン（自動で消さない寄り）

---

## 6. 入力（連想ワード等）：「Webフォーム」→「ゲームの道具」

- 入力欄は “凹み（inset）” を必ず持つ（入力＝穴）
- 枠は窓文法（薄めの3段でOK）
- focus-visible はボタンと同じ **二重リング**
- error は色だけ禁止（枠段数+1 or 左マーカー2px を併用）
- 補助文は 1行だけ（長文は説明窓へ退避）

---

## 7. トークン設計（テーマ非依存）

### 7-1. 骨格（スタイル非依存）で固定するもの

- 階層（HUD/窓/モーダル/通知）
- 状態セット（normal/hover/pressed/focus/selected/disabled/loading/locked）
- タップ最小（44〜48）
- 余白ルール（8/14/24）
- reduced-motion の代替方針

### 7-2. Base tokens（目安）

※ 実装は `STYLE_GUIDE.md` の tokens-first を優先（直値の増殖を避ける）。ここは “スケールの考え方” の目安。

- space: `0, 2, 4, 6, 8, 10, 12, 14, 16, 20, 24, 32, 40`（**14を入れる**）
- radii: `r0=0 / r1=4 / r2=8`
- stroke: `s1=1 / s2=2 / s3=3 / s4=4`
- typography scale: `12 / 14 / 16 / 20 / 24`
- elevation: cast と inset（ベベル）を中心に設計（ブラー強い影は最小）

### 7-3. Semantic tokens（役割名の例）

- `text`, `textMuted`, `textOnPrimary`
- `bg`, `surface`, `surfaceRaised`, `surfaceInset`
- `frameOuter`, `frameMid`, `frameInner`
- `primary`, `success`, `warning`, `danger`
- `focusOuter`, `focusInner`（二重リング用）

### 7-4. アイコン/タイポの補足（Web感を減らす）

- アイコン: 細線（Feather系）を避け、**線幅 2px** を基準にする（小サイズは見た目優先で太めでもOK）
- 角: ラウンド統一 or 直角統一（混在させない）
- 数字: タイマー/人数などは `tabular-nums` 前提（揺れ防止）

---

## 8. “AIっぽさ / Webっぽさ” 採点表（0/1/2点）

合計 20 点以上を目標（12項目なら満点24点）。

1. ボタンが物体か（face/rim/bevel/cast）
2. pressed が沈むか（沈み＋影/ベベル変化）
3. 決定の確定感があるか（短い枠点灯など）
4. Primary が 1画面1つを守れているか
5. focus-visible（二重リング）が統一されているか
6. 状態が色以外でも判別できるか（disabled/loading/locked）
7. 窓の階層が枠段数で分かるか（HUD/窓/モーダル）
8. モーダルがスケールに頼っていないか（Zの手前化）
9. 通知が SaaS 配置になっていないか（上寄せスタック）
10. 入力がフォームではなく道具（凹み）か
11. 余白が均一すぎないか（8/14/24 の段差）
12. reduced-motion で破綻しないか（移動/ズーム依存ゼロ）

---

## 9. コピー（文言）指針：Web語彙をゲーム語彙へ

禁止語彙（代表）: 「送信」「保存」「フォーム」「キャンセル」「OK」

置換例:

- 送信 → 提出
- 保存 → 確定 / 記録（文脈で）
- キャンセル → 戻る / やめる
- OK → 決定
- 更新 → 同期 / 再読み込み（通信文脈なら同期）

---

## 10. 実装メモ（このリポジトリで触る場所の例）

実装フェーズでは、原則 tokens/recipes に寄せて “一括で効く” 形にする。

- ボタン: `theme/recipes/button.recipe.ts` / `components/ui/AppButton.tsx`
- パネル/カード: `theme/` の slot recipes / semanticTokens（既存の方針に合わせる）
- tokens: `theme/index.ts`, `theme/semantic/*`, `theme/foundations/*`

注意: 直値の rgba/hex の増殖を避け、可能なら semanticTokens に吸い上げる（`STYLE_GUIDE.md` 準拠）。

### 10-1. 人間品質に直す順序（実務フロー）

AI案を “それっぽい” から “人間品質” に上げるときは、順序を固定してブレを防ぐ。

1. **トークン固定**（余白/角丸/線幅/影/タイプ/モーション）
2. **階層の3段階化**（主・副・補助を全画面で統一）
3. **状態設計を先に全部作る**（hover/pressed/disabled/focus/loading/locked/selected）
4. **最後に質感**（質感はルールが固まってから）

避ける（AIがやりがち）:

- 情報設計が固まる前に装飾で埋める
- モーションで “気持ちよさ” を誤魔化し、押下結果が曖昧
- 1画面だけ映えるUI（遷移すると整合が崩れる）
- 文字量を想定しない（推理ゲームはログ/説明が伸びる）

### 10-2. モーション（数値で管理する）

原則: “気持ちよさ” は感覚ではなく **数値（トークン）**で揃える。  
※ `prefers-reduced-motion: reduce` では、移動/ズームを原則ゼロに寄せる（色/枠/不透明度で代替）。

目安（ブラウザ前提の実務値）:

- Hover（カード/ボタン）: 120〜180ms
- Press down（押し込み）: 60〜100ms
- Release（戻り）: 100〜160ms
- Tooltip/Popover: 150〜220ms
- ダイアログ開閉: 220〜320ms
- 重い画面遷移: 300〜375ms（400ms超は慎重）

easing の基本セット（CSS `cubic-bezier()`）:

- Standard（基本）: `cubic-bezier(0.4, 0.0, 0.2, 1)`
- Deceleration（入場）: `cubic-bezier(0.0, 0.0, 0.2, 1)`
- Acceleration（退場）: `cubic-bezier(0.4, 0.0, 1, 1)`
- Sharp（素早い往復）: `cubic-bezier(0.4, 0.0, 0.6, 1)`

### 10-3. 日本語UIのタイポ（“崩れ方” まで管理）

- 日本語の **禁則/約物/括弧まわり** が雑だとAI感が出やすい（カード効果文/ログで顕著）
- “数字が強いゲーム” なので、数値の **桁揃え/単位/全角半角の統一** を決める（`tabular-nums` は前提）
- フォント混在を避ける（原則 2ファミリー以内）
- 長文が伸びる画面は、CSS で “崩れ方” を制御する（必要に応じて `line-break` / `word-break` / `overflow-wrap` など）

フォント候補（Web実装しやすい寄り・任意）:

- Noto Sans JP / Source Han Sans JP（源ノ角ゴ）/ BIZ UDゴシック / M PLUS 1p

### 10-4. パフォーマンス注意（据え置き感は 60fps から崩れる）

- 重い **ぼかし（blur）/ backdrop-filter / 大きいブラー影** は乱用しない（特にモバイルで体感が落ちる）
- “厚み” はブラー影より **ベベル（inset）＋短い接地影**で作る（見た目と負荷が両立しやすい）

---

## 11. 依頼テンプレ（コピペ用）

### 実装担当AIへの依頼（最小）

1. `docs/UI_CORE_SPEC.md` と `STYLE_GUIDE.md` と `theme/DESIGN_GUIDE.md` を読んでから着手。
2. テーマパック: （例 `docs/ui_theme/hd2d_pack.md` / または「なし」）
3. 対象: （ここに書く：例「AppButton と Panel と Modal」）
4. 目的: Web感/AI感を落として据え置きゲーム風にする（物体化・段差・二重フォーカス・8/14/24）。
5. 制約: tokens-first、`!important` 禁止、`prefers-reduced-motion` 対応、スマホは min 44〜48 ヒット領域。
6. 変更は UI 層のみ（ゲームロジック・Firebase・FSM には触れない）。
7. 実装後: `npm run typecheck` + 該当 E2E を最小本数で実行し、PC/スマホで見た目を確認。

### 追加で聞いてよい質問（最大7つ・ただし回答待ちで止めない）

- 入力の主：マウス主体？キーボード主体？（将来パッド想定はある？）
- 解像度/距離：FHD中心？ノート比率高い？
- 盤面の主：Pixi主＋DOM HUD？ DOM主？
- UIの硬さ：硬派寄り？上品寄り？中間？
- 情報密度：同時表示情報は多い？（8人/ログ/タイマー等）
- アクセシビリティ優先度（色覚/弱視/動き軽減）
- フォント制約（WebフォントOK？システム縛り？）
