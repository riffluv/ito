# 序の紋章 III（オンライン版） 置き換えコスト査定報告書（更新版）

**査定実施日**: 2025-12-18  
**査定者**: Codex (GPT-5.2)  
**査定範囲**: ローカルリポジトリ静的解析（コード・ドキュメント・テスト）  
**査定手法**: 3点見積り（min / most likely / max）

---

## 更新背景（2025-11-03 → 2025-12-18）

11月初旬の前回査定以降、実装が「動く」から「運用で折れにくい」へ寄っており、置き換え（再制作）時の必須要件も増えています。主な差分は以下です。

- **rooms/players の永続書き込みを Next.js API 経由に統一（API1本化）**（2025-12-07）  
  - クライアント直書き撤廃 / 例外フォールバックの整理 / 進行系 API 群の整備など（`docs/OPERATIONS.md` セクション15）
- **ルームごとの appVersion 固定 + join/create の version-check**（2025-12）  
  - “同じ部屋は同じ世界線”に固定し、古いタブや SW 由来の齟齬を運用で潰す（`docs/OPERATIONS.md` セクション14）
- **Firestore permission-denied 自動復旧（Heartbeat + Guard + 再試行）**（2025-11-15）  
  - 放置タブ/権限切れを「ユーザーの再読み込み依存」にしない（`docs/OPERATIONS.md` セクション13）
- **サーバー側 sanitize の刷新（ESM事故を踏まえた再発防止）**（2025-12-05〜07）  
  - 本番で API が静的 500 HTML を返す事故の再発防止メモまで含む（`docs/OPERATIONS.md` セクション15.2）
- **テスト資産の拡充**  
  - Playwright: `tests/*.spec.ts` が **25本**、Jest: `__tests__/*` が **41本**（2025-12-18時点）
- **API面の厚みが増加**  
  - `app/api/**/route.ts` が **40本**（rooms/spectator/presence/payments/webhooks 等）

---

## エグゼクティブサマリー（要点）

本プロジェクトは、ITO系協力推理ゲームをブラウザで実現するだけでなく、**リアルタイム同期**（Firestore + RTDB）、**サーバー主導の決定処理**（Next.js Route Handlers）、**PWA安全更新**（Service Worker + Update Channel）、**状態機械**（XState）、**演出/体験**（Pixi.js + GSAP + AudioWorklet）、**可観測性**（メトリクス・トレース・デバッグHUD）、**決済**（Stripe + Webhook）までを統合した“運用前提”の実装です。

同等以上の体験品質で再制作する場合の概算は以下です（売却価格ではなく、**再制作コスト**です）。

- **置き換え工数**: **28–64人月**（最頻: **42人月**）
- **費用換算（外注想定 / 目安）**: **3,360–9,600万円**（最頻: **5,040–6,300万円**）
  - 単価120万円/人月時: 3,360 / 5,040 / 7,680（万円）
  - 単価150万円/人月時: 4,200 / 6,300 / 9,600（万円）
- **参考: 企業フルコスト（間接費+リスクを積む）**: **4,700–17,800万円**（最頻: **約8,000万円**）

> 注: 置き換えコストは「同等体験を、運用可能な品質で作り直す」金額です。  
> 売却価格は、権利（アセット/ブランド）と引継ぎ体制、買い手の統合コストで大きく乖離します。

---

## 1. WBS（Work Breakdown Structure）と人月見積り（合計が一致する形で再整理）

この章では、重複カウントを避けるため、あえて **4バケットに集約**し、合計がそのまま総人月になる形で提示します。

### 1.1 バックエンド/同期（Firestore + RTDB + API + Functions + Stripe）［実装］

| 工程 | min人月 | most likely人月 | max人月 | 根拠（例） |
|------|--------:|----------------:|--------:|-----------|
| データモデル/ルール設計・実装 | 2.0 | 3.0 | 5.0 | Firestore rooms/players、RTDB presence、API主導の更新ポリシー（`docs/OPERATIONS.md`） |
| RTDB Presence（heartbeat/onDisconnect/安定判定） | 2.5 | 4.0 | 6.0 | RTDB authoritative / `presenceReady` 前提の人数判定 |
| Next.js API + サーバーコマンド群（進行/権限/観戦/復帰） | 5.0 | 8.0 | 12.0 | `app/api/**/route.ts`（40本）・server-authoritativeポリシー（`docs/OPERATIONS.md` セクション15） |
| Cloud Functions（quickStart等） | 1.0 | 1.5 | 2.5 | `functions/src/*` / 運用手順（`docs/OPERATIONS.md` セクション10） |
| Stripe（Checkout + Webhook + 証跡） | 1.0 | 2.0 | 3.0 | `app/api/webhooks/stripe/route.ts` / `lib/server/stripeCheckout.ts` |
| 運用ハードニング（version-check / permission guard / sanitize刷新） | 1.5 | 1.5 | 2.5 | `docs/OPERATIONS.md` セクション13-15（2025-11-15, 2025-12-07 等） |
| **小計** | **13.0** | **20.0** | **31.0** |  |

### 1.2 フロントエンド/体験（Next.js + Chakra + XState + DnD + Pixi/GSAP + Audio + PWA）［実装］

| 工程 | min人月 | most likely人月 | max人月 | 根拠（例） |
|------|--------:|----------------:|--------:|-----------|
| ゲームUI実装（ロビー/ルーム/盤面/チャット等） | 3.0 | 4.5 | 6.0 | `components/*`, `app/*`, Chakra UI v3 |
| 状態機械（roomMachine / spectator）+ hooks統合 | 1.5 | 2.5 | 4.0 | `lib/state/roomMachine.ts` / `useRoomState` 系 |
| DnD（dnd-kit）+ proposalScheduler最適化 | 1.5 | 1.5 | 2.5 | `lib/game/proposalScheduler.ts` / DnD周辺 |
| Pixi/GSAP演出（Showtime/背景/HUD/カード反転） | 2.0 | 3.5 | 6.0 | `lib/showtime/*`, `components/ui/*Background*`, `components/ui/GameCard.tsx` |
| 音声（低遅延 / prewarm / メトリクス） | 0.5 | 1.0 | 2.0 | `lib/audio/*`, AudioWorklet（`public/audio-worklets/*`） |
| PWA Safe UpdateのUI/抑止統合 | 0.5 | 1.0 | 1.5 | `public/sw.js`, `components/ui/SafeUpdateBanner.tsx`, `lib/serviceWorker/*` |
| **小計** | **9.0** | **14.0** | **22.0** |  |

### 1.3 テスト/QA（Jest + Playwright）［非機能検証］

| 工程 | min人月 | most likely人月 | max人月 | 根拠（例） |
|------|--------:|----------------:|--------:|-----------|
| Jest（ドメイン/状態/決済/更新/回線断など） | 1.5 | 2.5 | 4.0 | `__tests__/*`（41本） |
| Playwright（同期/観戦/タッチ/DPI/オフライン等） | 1.0 | 2.0 | 3.0 | `tests/*.spec.ts`（25本） |
| QA（手動/端末差分/リグレッション） | 0.5 | 0.5 | 1.0 | iPad/Safari/多タブ等の再現検証 |
| **小計** | **3.0** | **5.0** | **8.0** |  |

### 1.4 ドキュメント/運用準備/PM（Runbook + チェックリスト + バッファ）

| 工程 | 人月 | 根拠（例） |
|------|----:|-----------|
| 運用Runbook（更新/同期/観戦/インシデント） | 1.0 | `docs/OPERATIONS.md`, `docs/SAFE_UPDATE_TEST_PLAN.md` |
| デバッグ手順（メトリクス採取/切り分け） | 0.5 | `docs/DEBUG_METRICS.md` |
| PM/調整/予備バッファ | 1.5 | 仕様差分の吸収・炎上回避の余白 |
| **小計** | **3.0** |  |

---

### 合計人月見積り（= 上記小計の合算）

| 項目 | min人月 | most likely人月 | max人月 |
|------|--------:|----------------:|--------:|
| **総合計** | **28.0** | **42.0** | **64.0** |

---

## 2. 費用換算（万円表記）

### 2.1 人月単価別の費用レンジ（外注/採用の概算）

| 単価（万円/人月） | min費用（28人月） | most likely費用（42人月） | max費用（64人月） |
|------------------:|------------------:|--------------------------:|------------------:|
| 90 | 2,520 | 3,780 | 5,760 |
| 120 | 3,360 | 5,040 | 7,680 |
| 150 | 4,200 | 6,300 | 9,600 |

**推奨レンジ（外注想定）**: **3,360–9,600万円**（端数丸め）  
**最頻値（参考）**: **5,040–6,300万円**（単価120〜150 × 42人月）

### 2.2 参考: 企業フルコスト（間接費+リスク係数を積む）

置き換えコストは、外注費だけでなく **間接費（管理/採用/会議/機材/検証環境）** と  
**リスク係数（端末差分・同期事故・更新事故・セキュリティ）** を積むのが実務的です。

計算式（例）:

`フルコスト = (人月×単価) × (1+間接費率) × (1+リスク係数) + 固定費`

| ケース | 前提 | 計算 | 目安（万円） |
|------|------|------|------------:|
| 低（例） | 28人月・単価120・間接費25%・リスク10%・固定費50 | (3,360×1.25×1.10)+50 | 4,670 |
| 中（例） | 42人月・単価120・間接費30%・リスク20%・固定費120 | (5,040×1.30×1.20)+120 | 7,980 |
| 高（例） | 64人月・単価150・間接費35%・リスク35%・固定費300 | (9,600×1.35×1.35)+300 | 17,800 |

**参考レンジ（フルコスト）**: **4,700–17,800万円**

---

## 3. シナリオ別費用帯（万円）

### 3.1 MVP（演出控えめ・運用/観戦/更新は最小）

- **スコープ**: ルーム + 同期 + 最小UI（DnD/観戦/SW安全更新/計測は抑制）
- **人月**: 18–28人月
- **費用目安**: **2,200–4,200万円**（単価120〜150想定）

### 3.2 一般公開（安定運用・計測・E2E基本）

- **スコープ**: RTDB presence / Safe Update / 計測 / 基本E2E まで含めた一般公開レベル
- **人月**: 28–42人月
- **費用目安**: **3,400–6,300万円**（単価120〜150想定）

### 3.3 現行同等（運用ハードニング込み / API主導で破綻しにくい）

- **スコープ**: API1本化、version-check、permission guard、sanitize刷新、観戦フロー、テスト資産（Jest/Playwright多数）まで含める
- **人月**: 42–64人月
- **費用目安**: **5,000–9,600万円**（単価120〜150想定）

---

## 4. 権利スキーム別参考価格（万円）※置き換えコストとは別軸

この節は **「売却/ライセンスの交渉レンジ」** の参考です。  
権利（アセット/ブランド）・引継ぎ・買い手の統合前提で大きく変動します。

### 4.1 非独占ライセンス（用途/期間制限、ソース非開示可）

- **価格目安**: **500–1,500万円**
- **メモ**: “使う権利”は置き換えコストの一部しか移転しない（競合利用も起こり得る）ため低め

### 4.2 限定独占（領域/年限2–3年）

- **価格目安**: **1,200–3,000万円**
- **メモ**: 独占範囲が明確で、買い手が統合コストを抑えられる場合に上がる

### 4.3 完全権利譲渡（ソース/ドキュメント/運用一式 + 引継ぎ）

- **価格目安**: **2,500–7,500万円**
- **メモ**: 権利台帳が整備されているほど上振れ。未整備の場合は是正コスト分ディスカウントされやすい

---

## 5. 定着率・収益化に効く要素と上振れ係数（置き換え困難性の補足）

### 5.1 "いつ行っても誰かいる"感のSLO

- ロビー初期可視 ≤ 750ms
- "今プレイ中"表示 ≤ 400ms
- 観戦入室→盤面可視 ≤ 1.5s
- D&D反映 ≤ 50ms

**価値**: DAUとセッション長を押し上げる可能性（仮説）。  
**上振れ係数（再制作時の難易度）**: +10–20%

### 5.2 API1本化 + version-check + Safe Update（運用で折れにくい堀）

- “直書きを許す”実装より、API主導へ揃える方が長期運用の事故率が下がる反面、初期実装は増える
- 置き換え時にこのレベルの運用設計まで再現するなら、単純なゲームUI実装では到達しない

**上振れ係数（再制作時の難易度）**: +10–25%

### 5.3 Showtime演出（Pixi.js + GSAP）と音の立ち上がり

- 3D回転、背景/HUD分離、reduced-motion、AudioWorklet等の“体験品質”の積み上げは、後から足すほど高くつく

**上振れ係数（再制作時の難易度）**: +10–20%

---

## 6. リスクと不確実性（項目別 ±%）

| リスク要因 | 影響 | 補正率 | 説明 |
|-----------|------|-------:|------|
| 端末多様性（DPI 125%/150%/iPad/Safari） | 高 | +10–20% | DPI/タッチ/音/描画の差分を吸収する検証コスト |
| 回線断/多タブ/権限切れ | 中 | +5–15% | permission-denied 自動復旧や復帰シナリオの再現 |
| SW更新事故（待機/抑止/適用） | 中 | +5–15% | Safe Update の失敗系・ループガードまで含めた再現 |
| デプロイ設定事故（Static Export等） | 中 | +5–10% | `/api/*` が壊れる運用事故の回避（`docs/OPERATIONS.md` セクション4.1/15.2） |
| アセットライセンス未整備 | 高 | +0–25% | 置き換え時にアセット再制作/差し替えが必要になる可能性 |
| モデレーション/不正対策 | 低〜中 | +0–10% | 公開規模やチャット運用方針次第で増える |

---

## 7. 追加質問（精度向上に必要な前提確認）

1. アセット（画像/音/フォント）の**権利台帳**はあるか？（再配布可否・クレジット要否）
2. 本番の DAU/MAU/同時接続/平均セッション長/ルーム作成数はどの程度か？
3. Firebaseの月額（Firestore/RTDB/Functions/Auth）と、コスト上限/アラート運用はあるか？
4. Stripeの実績（件数/平均単価/返金/チャージバック）と、販売対象（観戦/寄付/テーマ等）の現状は？
5. 想定する買い手（個人/スタジオ/企業）と、必須条件（Firebase継続可否、IP厳格度、SLA）は？

---

## 8. 断り書き

本査定は、**ローカルリポジトリの静的解析**（コード・ドキュメント・テスト）に基づく概算です。以下は含まれません。

- 実トラフィックの負荷試験（Firestore/RTDBの課金上限含む）
- 実機網羅（Safari/低スペ端末/企業ネットワーク制限等）の完全検証
- アセットライセンス監査（権利・商標・類似表現の精査）

---

## 9. 体験価値（オリジナリティ）の補足

### 9.1 相談タイムの再発明

- 失敗後の「惰性の答え合わせ」を、ドラッグ編集可能な並べ替えボードに変換し、会話の起点を作る

### 9.2 Showtime演出（Pixi.js + GSAP）

- 全参加者カードの3D回転、BGM/SFX同期、背景テーマ連動などで“見せ場”を設計

### 9.3 観戦体験の拡張

- 観戦→席戻り（ホスト承認）など、途中参加でゲームを壊さない設計を状態機械とAPIで担保

---

## 10. 結論

現行の「序の紋章 III（オンライン版）」を **同等品質でゼロから置き換える**なら、概算で **28–64人月（最頻 42人月）**、外注換算で **3,360–9,600万円**、企業フルコストでは **4,700–17,800万円** 程度が妥当です。

前回査定（2025-11-03）以降に追加された **API1本化 / version-check / permission-denied自動復旧 / sanitize刷新 / テスト拡充** は、見た目以上に「運用の事故率」を下げる層であり、同等に再現するほど置き換えコストが上がります。

---

**査定完了日**: 2025-12-18  
**次回更新**: 実測メトリクス（DAU/同時接続/コスト）とアセット権利台帳の提供後

