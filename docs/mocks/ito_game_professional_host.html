<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITO - Professional Game Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Professional Color System */
            --blue-50: #f0f9ff;
            --blue-100: #e0f2fe;
            --blue-500: #0ea5e9;
            --blue-600: #0284c7;
            --blue-700: #0369a1;
            
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-200: #e2e8f0;
            --slate-300: #cbd5e1;
            --slate-400: #94a3b8;
            --slate-500: #64748b;
            --slate-600: #475569;
            --slate-700: #334155;
            --slate-800: #1e293b;
            --slate-900: #0f172a;
            
            --green-50: #f0fdf4;
            --green-100: #dcfce7;
            --green-500: #22c55e;
            --green-600: #16a34a;
            
            --red-50: #fef2f2;
            --red-100: #fee2e2;
            --red-500: #ef4444;
            
            --amber-50: #fffbeb;
            --amber-100: #fef3c7;
            --amber-500: #f59e0b;
            
            --white: #ffffff;
            
            /* Typography */
            --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
            --font-jp: 'Noto Sans JP', var(--font-sans);
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            
            /* Radius */
            --radius-sm: 0.125rem;
            --radius: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            
            /* Transitions */
            --transition: all 0.15s ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-jp);
            background-color: var(--slate-50);
            color: var(--slate-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .game-layout {
            display: grid;
            grid-template-areas:
                "header header header"
                "sidebar main-area chat"
                "hand hand hand";
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: auto 1fr 180px;
            height: 100vh;
            gap: 1px;
        }

        /* Header */
        .header {
            grid-area: header;
            background: var(--white);
            border-bottom: 1px solid var(--slate-200);
            padding: var(--space-4) var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--slate-900);
            font-family: var(--font-sans);
        }

        .room-info {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .room-code {
            background: var(--slate-100);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-family: 'Monaco', monospace;
            font-size: 0.875rem;
            color: var(--slate-700);
            border: 1px solid var(--slate-200);
        }

        .phase-indicator {
            background: var(--blue-500);
            color: var(--white);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Sidebar */
        .sidebar {
            grid-area: sidebar;
            background: var(--white);
            border-right: 1px solid var(--slate-200);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: var(--space-6) var(--space-6) var(--space-4);
            border-bottom: 1px solid var(--slate-200);
        }

        .sidebar-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-2);
        }

        .player-count {
            font-size: 0.875rem;
            color: var(--slate-600);
        }

        .player-list {
            padding: var(--space-4) var(--space-6);
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--slate-100);
        }

        .player-item:last-child {
            border-bottom: none;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-1);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .player-badge {
            background: var(--blue-100);
            color: var(--blue-700);
            font-size: 0.75rem;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .player-badge.host {
            background: var(--amber-100);
            color: var(--amber-500);
        }

        .player-badge.you {
            background: var(--green-100);
            color: var(--green-600);
        }

        .player-clue {
            font-size: 0.875rem;
            color: var(--slate-600);
            font-style: italic;
        }

        .player-clue.pending {
            color: var(--slate-400);
        }

        .player-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green-500);
            margin-top: var(--space-1);
        }

        .player-status.pending {
            background: var(--slate-300);
        }

        .player-status.active {
            background: var(--blue-500);
        }

        /* Main Area */
        .main-area {
            grid-area: main-area;
            background: var(--white);
            padding: var(--space-8);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .theme-section {
            text-align: center;
            margin-bottom: var(--space-8);
        }

        .theme-card {
            background: var(--slate-900);
            color: var(--white);
            padding: var(--space-8);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-4);
        }

        .theme-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .theme-text {
            font-size: 2.25rem;
            font-weight: 700;
            line-height: 1.1;
        }

        .instruction-text {
            color: var(--slate-600);
            max-width: 480px;
            margin: 0 auto;
        }

        .game-board {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .board-header {
            font-weight: 600;
            color: var(--slate-700);
            margin-bottom: var(--space-6);
        }

        .card-area {
            background: var(--slate-50);
            border: 2px dashed var(--slate-300);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-4);
            flex-wrap: wrap;
            margin-bottom: var(--space-6);
        }

        .card-slot {
            width: 80px;
            height: 112px;
            border: 2px dashed var(--slate-300);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            transition: var(--transition);
            position: relative;
        }

        .card-slot.drop-target {
            border-color: var(--blue-500);
            background: var(--blue-50);
        }

        .start-marker {
            color: var(--slate-400);
            font-weight: 700;
            font-size: 1.5rem;
        }

        .player-card {
            width: 76px;
            height: 108px;
            background: var(--white);
            border: 2px solid var(--slate-300);
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--blue-500);
        }

        .player-card:active {
            cursor: grabbing;
        }

        .card-name {
            font-size: 0.75rem;
            color: var(--slate-500);
            margin-bottom: var(--space-1);
            font-weight: 500;
        }

        .card-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--slate-400);
        }

        .progress-section {
            background: var(--slate-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
        }

        .progress-text {
            color: var(--slate-600);
            margin-bottom: var(--space-3);
        }

        .status-badges {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-badge {
            background: var(--slate-100);
            color: var(--slate-600);
            font-size: 0.75rem;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius);
            font-weight: 500;
        }

        .status-badge.ready {
            background: var(--green-100);
            color: var(--green-600);
        }

        .status-badge.waiting {
            background: var(--amber-100);
            color: var(--amber-500);
        }

        /* Chat Panel */
        .chat-panel {
            grid-area: chat;
            background: var(--white);
            border-left: 1px solid var(--slate-200);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: var(--space-6) var(--space-6) var(--space-4);
            border-bottom: 1px solid var(--slate-200);
        }

        .chat-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--slate-900);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4) var(--space-6);
            gap: var(--space-3);
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 90%;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
        }

        .message.system {
            background: var(--slate-100);
            color: var(--slate-600);
            text-align: center;
            max-width: 100%;
            font-style: italic;
        }

        .message.other {
            background: var(--slate-100);
            color: var(--slate-900);
            align-self: flex-start;
        }

        .message.own {
            background: var(--blue-500);
            color: var(--white);
            align-self: flex-end;
        }

        .message-header {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: var(--space-1);
        }

        .chat-input-area {
            padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--slate-200);
            display: flex;
            gap: var(--space-2);
        }

        .chat-input {
            flex: 1;
            padding: var(--space-3);
            border: 1px solid var(--slate-300);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            resize: none;
            max-height: 80px;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--blue-500);
            box-shadow: 0 0 0 3px var(--blue-50);
        }

        .chat-send {
            background: var(--blue-500);
            color: var(--white);
            border: none;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-send:hover {
            background: var(--blue-600);
        }

        /* Hand Panel */
        .hand-panel {
            grid-area: hand;
            background: var(--white);
            border-top: 1px solid var(--slate-200);
            padding: var(--space-6);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-8);
        }

        .my-card-section {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }

        .my-card {
            width: 120px;
            height: 168px;
            background: var(--slate-900);
            color: var(--white);
            border-radius: var(--radius-xl);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
        }

        .my-card-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .my-card-number {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
        }

        .card-info {
            text-align: left;
        }

        .card-info-label {
            font-size: 0.875rem;
            color: var(--slate-500);
            margin-bottom: var(--space-1);
        }

        .card-info-value {
            font-weight: 600;
            color: var(--slate-900);
        }

        .clue-section {
            flex: 1;
            max-width: 400px;
        }

        .clue-label {
            font-weight: 600;
            color: var(--slate-900);
            margin-bottom: var(--space-2);
            display: block;
        }

        .clue-input {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid var(--slate-300);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            background: var(--slate-50);
            transition: var(--transition);
        }

        .clue-input:focus {
            outline: none;
            border-color: var(--blue-500);
            box-shadow: 0 0 0 3px var(--blue-50);
            background: var(--white);
        }

        .clue-help {
            font-size: 0.75rem;
            color: var(--slate-500);
            margin-top: var(--space-1);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-3);
        }

        .btn {
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-lg);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: var(--blue-500);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--blue-600);
        }

        .btn-secondary {
            background: var(--slate-200);
            color: var(--slate-700);
        }

        .btn-secondary:hover {
            background: var(--slate-300);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .game-layout {
                grid-template-areas:
                    "header"
                    "main-area"
                    "sidebar"
                    "hand";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto auto;
            }

            .chat-panel {
                display: none;
            }

            .hand-panel {
                flex-direction: column;
                gap: var(--space-6);
            }

            .my-card-section {
                width: 100%;
                justify-content: center;
            }

            .clue-section {
                width: 100%;
                max-width: none;
            }

            .action-buttons {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: var(--space-3) var(--space-4);
            }

            .room-info {
                flex-direction: column;
                gap: var(--space-2);
                align-items: flex-end;
            }

            .main-area {
                padding: var(--space-6) var(--space-4);
            }

            .theme-text {
                font-size: 1.875rem;
            }

            .my-card {
                width: 100px;
                height: 140px;
            }

            .my-card-number {
                font-size: 2.5rem;
            }

            .card-area {
                padding: var(--space-4);
                min-height: 160px;
            }

            .player-card {
                width: 64px;
                height: 90px;
            }

            .card-slot {
                width: 68px;
                height: 94px;
            }
        }

        /* Drag & Drop States */
        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zone-active {
            background: var(--blue-50);
            border-color: var(--blue-500);
        }

        /* === Host Controls (Pro-Grade) === */
        .host-quick {
            display: flex;
            gap: var(--space-2);
            margin-left: var(--space-4);
        }
        .btn-ghost {
            background: transparent;
            color: var(--slate-700);
            border: 1px solid var(--slate-300);
        }
        .btn-ghost:hover { background: var(--slate-100); }
        .btn-danger {
            background: var(--red-500);
            color: var(--white);
        }
        .btn-danger:hover { filter: brightness(0.95); }
        .host-dock {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 420px;
            max-width: calc(100vw - 32px);
            background: var(--white);
            border: 1px solid var(--slate-200);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            z-index: 60;
        }
        .host-dock[hidden] { display: none; }
        .host-dock .dock-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--slate-200);
            background: var(--slate-50);
        }
        .dock-title {
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        .dock-title .led {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: var(--slate-300);
        }
        .dock-body {
            padding: var(--space-5);
            display: grid;
            gap: var(--space-5);
        }
        .segmented {
            display: inline-flex;
            border: 1px solid var(--slate-300);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        .segmented input { display: none; }
        .segmented label {
            padding: var(--space-2) var(--space-4);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--slate-600);
            user-select: none;
        }
        .segmented label + label { border-left: 1px solid var(--slate-300); }
        .segmented input:checked + label {
            background: var(--blue-500);
            color: var(--white);
        }
        .dock-section-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--slate-700);
            letter-spacing: .02em;
        }
        .dock-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-3);
        }
        .dock-actions .btn {
            width: 100%;
            justify-self: stretch;
        }
        .timer {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-variant-numeric: tabular-nums;
            color: var(--slate-700);
        }
        .timer-display {
            font-weight: 700;
            font-size: 1.25rem;
            padding: 6px 10px;
            border: 1px solid var(--slate-300);
            border-radius: var(--radius-md);
            min-width: 72px;
            text-align: center;
            background: var(--slate-50);
        }
        .host-fab {
            position: fixed;
            right: 24px;
            bottom: 24px;
            width: 56px;
            height: 56px;
            border-radius: 999px;
            border: none;
            background: var(--blue-500);
            color: white;
            font-weight: 800;
            box-shadow: var(--shadow-lg);
            z-index: 50;
            display: none;
        }
        .host-fab:hover { background: var(--blue-600); }
        @media (max-width: 768px) {
            .host-quick { display: none; }
            .host-dock { width: 96vw; right: 2vw; bottom: 84px; }
            .host-fab { display: inline-flex; align-items: center; justify-content: center; }
        }

    </style>
</head>
<body>
    <div class="game-layout">
        <!-- Header -->
        <header class="header">
            <div class="game-title">ITO</div>
            <div class="room-info">
                <div class="host-quick" id="hostQuick">
                    <button class="btn btn-primary" id="startBtn">開始</button>
                    <button class="btn btn-ghost" id="toggleDockBtn">ホストパネル</button>
                </div>

                <div class="room-code">ABC123</div>
                <div class="phase-indicator">ヒント入力フェーズ</div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">プレイヤー</div>
                <div class="player-count">5/6人</div>
            </div>
            
            <div class="player-list">
                <div class="player-item">
                    <div class="player-info">
                        <div class="player-name">
                            たろう
                            <span class="player-badge host">ホスト</span>
                        </div>
                        <div class="player-clue">ヒント: お米のおいしさ</div>
                    </div>
                    <div class="player-status"></div>
                </div>

                <div class="player-item">
                    <div class="player-info">
                        <div class="player-name">
                            あなた
                            <span class="player-badge you">自分</span>
                        </div>
                        <div class="player-clue pending">ヒント入力中...</div>
                    </div>
                    <div class="player-status active"></div>
                </div>

                <div class="player-item">
                    <div class="player-info">
                        <div class="player-name">はなこ</div>
                        <div class="player-clue">ヒント: キムチの辛さ</div>
                    </div>
                    <div class="player-status"></div>
                </div>

                <div class="player-item">
                    <div class="player-info">
                        <div class="player-name">じろう</div>
                        <div class="player-clue">ヒント: 焚き火の温度</div>
                    </div>
                    <div class="player-status"></div>
                </div>

                <div class="player-item">
                    <div class="player-info">
                        <div class="player-name">さくら</div>
                        <div class="player-clue pending">ヒント待ち</div>
                    </div>
                    <div class="player-status pending"></div>
                </div>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="main-area">
            <section class="theme-section">
                <div class="theme-card">
                    <div class="theme-label">今回のお題</div>
                    <div class="theme-text">辛さ・熱さ</div>
                </div>
                <div class="instruction-text">
                    あなたの数字を「辛さ・熱さ」で表現してください。<br>
                    <strong>数字そのものは絶対に言わないように！</strong>
                </div>
            </section>

            <section class="game-board">
                <div class="board-header">
                    カードを小さい順（左）から大きい順（右）に並べよう！
                </div>
                
                <div class="card-area">
                    <div class="card-slot">
                        <div class="start-marker">0</div>
                    </div>
                    
                    <div class="card-slot drop-target"></div>
                    
                    <div class="player-card" draggable="true">
                        <div class="card-name">たろう</div>
                        <div class="card-number">?</div>
                    </div>
                    
                    <div class="card-slot drop-target"></div>
                    
                    <div class="player-card" draggable="true">
                        <div class="card-name">はなこ</div>
                        <div class="card-number">?</div>
                    </div>
                    
                    <div class="card-slot"></div>
                    
                    <div class="player-card" draggable="true">
                        <div class="card-name">じろう</div>
                        <div class="card-number">?</div>
                    </div>
                </div>
                
                <div class="progress-section">
                    <div class="progress-text">
                        準備状況: <strong>3/5人</strong> がヒントを入力しました
                    </div>
                    <div class="status-badges">
                        <span class="status-badge ready">たろう</span>
                        <span class="status-badge ready">はなこ</span>
                        <span class="status-badge ready">じろう</span>
                        <span class="status-badge waiting">あなた</span>
                        <span class="status-badge waiting">さくら</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- Chat Panel -->
        <aside class="chat-panel">
            <div class="chat-header">
                <div class="chat-title">チャット</div>
            </div>
            
            <div class="chat-messages">
                <div class="message other">
                    <div class="message-header">たろう • 15:30</div>
                    みんな、頑張ろう！
                </div>
                
                <div class="message other">
                    <div class="message-header">はなこ • 15:32</div>
                    キムチって結構辛いよね？
                </div>
                
                <div class="message other">
                    <div class="message-header">じろう • 15:34</div>
                    焚き火は熱いけど、どのくらいかな...
                </div>
            </div>
            
            <div class="chat-input-area">
                <textarea class="chat-input" placeholder="メッセージを入力..." rows="1"></textarea>
                <button class="chat-send">送信</button>
            </div>
        </aside>

        <!-- Hand Panel -->
        <section class="hand-panel">
            <div class="my-card-section">
                <div class="my-card">
                    <div class="my-card-label">あなたの数字</div>
                    <div class="my-card-number">73</div>
                </div>
                
                <div class="card-info">
                    <div class="card-info-label">カードの位置予想</div>
                    <div class="card-info-value">中程度～高め</div>
                </div>
            </div>

            <div class="clue-section">
                <label class="clue-label" for="clueInput">
                    あなたのヒント（「辛さ・熱さ」で表現）
                </label>
                <input 
                    class="clue-input" 
                    type="text" 
                    id="clueInput"
                    placeholder="例: お風呂のちょうどいい温度..."
                    value="夏の車のハンドルくらい"
                    maxlength="50">
                <div class="clue-help">12 / 50文字</div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary">クリア</button>
                <button class="btn btn-primary">ヒント確定</button>
            </div>
        </section>
    </div>

    <script>
        // Basic drag and drop functionality
        let draggedElement = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeChat();
            initializeClueInput();
        });

        function initializeDragAndDrop() {
            const cards = document.querySelectorAll('.player-card');
            const slots = document.querySelectorAll('.card-slot');

            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            slots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
                slot.addEventListener('dragenter', handleDragEnter);
                slot.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.card-slot').forEach(slot => {
                slot.classList.remove('drop-zone-active');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            if (e.target.classList.contains('card-slot')) {
                e.target.classList.add('drop-zone-active');
            }
        }

        function handleDragLeave(e) {
            if (e.target.classList.contains('card-slot')) {
                e.target.classList.remove('drop-zone-active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drop-zone-active');
            
            if (draggedElement && e.target.classList.contains('card-slot')) {
                e.target.appendChild(draggedElement);
            }
        }

        function initializeChat() {
            const chatInput = document.querySelector('.chat-input');
            const chatSend = document.querySelector('.chat-send');
            const chatMessages = document.querySelector('.chat-messages');

            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    const time = new Date().toLocaleTimeString('ja-JP', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    const messageEl = document.createElement('div');
                    messageEl.className = 'message own';
                    messageEl.innerHTML = `
                        <div class="message-header">あなた • ${time}</div>
                        ${escapeHtml(message)}
                    `;
                    
                    chatMessages.appendChild(messageEl);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    chatInput.value = '';
                }
            }

            chatSend.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Auto-resize textarea
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 80) + 'px';
            });
        }

        function initializeClueInput() {
            const clueInput = document.getElementById('clueInput');
            const clueHelp = document.querySelector('.clue-help');
            const submitBtn = document.querySelector('.btn-primary');
            const clearBtn = document.querySelector('.btn-secondary');

            function updateCharCount() {
                const count = clueInput.value.length;
                const max = 50;
                clueHelp.textContent = `${count} / ${max}文字`;
            }

            clueInput.addEventListener('input', updateCharCount);

            submitBtn.addEventListener('click', function() {
                const clue = clueInput.value.trim();
                if (clue) {
                    this.textContent = '送信完了';
                    this.disabled = true;
                    setTimeout(() => {
                        this.textContent = '変更する';
                        this.disabled = false;
                    }, 1500);
                }
            });

            clearBtn.addEventListener('click', function() {
                clueInput.value = '';
                clueInput.focus();
                updateCharCount();
            });

            updateCharCount();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    
        // === Host Controls Logic ===
        const state = {
            phase: 'pre',  // pre -> select -> hint -> arrange -> reveal
            mode: 'normal',
            timer: { total: 60, remaining: 60, handle: null, running: false },
            hintsLocked: false
        };

        function qs(sel, root=document){ return root.querySelector(sel); }
        function qsa(sel, root=document){ return [...root.querySelectorAll(sel)]; }
        function setPhase(p){
            state.phase = p;
            const phaseTextMap = {
                'pre': '待機中',
                'select': 'お題選択',
                'hint': 'ヒント入力フェーズ',
                'arrange': '並べ替えフェーズ',
                'reveal': '結果発表'
            };
            // header badge
            const headerPhase = qs('.phase-indicator');
            if (headerPhase) headerPhase.textContent = phaseTextMap[p] || p;
            // dock badge
            const dockPhase = qs('#dockPhase');
            if (dockPhase) dockPhase.textContent = phaseTextMap[p] || p;
            // LED
            const led = qs('#dockLed');
            if (led){
                led.style.background = (p === 'pre') ? 'var(--slate-300)' :
                                       (p === 'select') ? 'var(--amber-500)' :
                                       (p === 'hint') ? 'var(--blue-500)' :
                                       (p === 'arrange') ? 'var(--green-500)' :
                                       'var(--slate-500)';
            }
        }

        function pickThemeByMode(){
            const themeText = qs('.theme-text');
            const themeLabel = qs('.theme-label');
            const pools = {
                normal: ['辛さ・熱さ','速さ','大きさ','価格','重さ','人気','甘さ','明るさ'],
                rainbow: ['赤み','オレンジ感','黄色さ','緑っぽさ','青さ','藍っぽさ','紫み'],
                classic: ['古さ','希少さ','知名度','高級感','便利さ','危険度','かわいさ']
            };
            const pool = pools[state.mode] || pools.normal;
            const chosen = pool[Math.floor(Math.random()*pool.length)];
            const idx = Math.floor(Math.random()*100)+1;
            if (themeLabel) themeLabel.textContent = '今回のお題';
            if (themeText) themeText.textContent = `${chosen}（#${idx}）`;
            // Announce to chat
            const chatMessages = qs('.chat-messages');
            if (chatMessages){
                const sys = document.createElement('div');
                sys.className = 'message system';
                sys.innerHTML = `ホストがお題を決定: <strong>${chosen}</strong>（#${idx}）`;
                chatMessages.appendChild(sys);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function shuffleCards(){
            const area = qs('.card-area');
            const cards = qsa('.player-card', area);
            // Fisher–Yates
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            cards.forEach(c => area.appendChild(c));
            announce('カードをシャッフルしました');
        }

        function assignNumbersMock(){
            // mock: just change progress text
            const progress = qs('.progress-text');
            if (progress){
                progress.innerHTML = '番号の配布が完了しました。ゲームを開始できます。';
            }
            announce('番号を配布しました');
        }

        function toggleHintsLock(){
            state.hintsLocked = !state.hintsLocked;
            const input = qs('#clueInput');
            if (input){
                input.disabled = state.hintsLocked;
                input.style.opacity = state.hintsLocked ? 0.6 : 1;
            }
            const btn = qs('#lockHintsBtn');
            if (btn){
                btn.textContent = state.hintsLocked ? 'ヒント解除' : 'ヒントロック';
            }
            announce(state.hintsLocked ? 'ヒント入力をロックしました' : 'ヒント入力を解除しました');
        }

        function announce(text){
            const chatMessages = qs('.chat-messages');
            if (!chatMessages) return;
            const sys = document.createElement('div');
            sys.className = 'message system';
            sys.textContent = text;
            chatMessages.appendChild(sys);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function openDock(open=true){
            const dock = qs('#hostDock');
            if (!dock) return;
            if (open) dock.removeAttribute('hidden');
            else dock.setAttribute('hidden','');
        }

        // Timer controls
        function formatTime(sec){
            const m = String(Math.floor(sec/60)).padStart(2,'0');
            const s = String(sec%60).padStart(2,'0');
            return `${m}:${s}`;
        }
        function updateTimer(){
            const disp = qs('#timerDisplay');
            if (disp) disp.textContent = formatTime(state.timer.remaining);
        }
        function timerStart(){
            if (state.timer.running) return;
            state.timer.running = true;
            state.timer.handle = setInterval(()=>{
                state.timer.remaining = Math.max(0, state.timer.remaining - 1);
                updateTimer();
                if (state.timer.remaining <= 0){
                    timerPause();
                    announce('タイマーが終了しました');
                }
            }, 1000);
        }
        function timerPause(){
            state.timer.running = false;
            if (state.timer.handle){
                clearInterval(state.timer.handle);
                state.timer.handle = null;
            }
        }
        function timerReset(sec=60){
            timerPause();
            state.timer.total = sec;
            state.timer.remaining = sec;
            updateTimer();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Quick buttons
            const startBtn = qs('#startBtn');
            const toggleDockBtn = qs('#toggleDockBtn');
            const closeDockBtn = qs('#closeDockBtn');
            const hostFab = qs('#hostFab');

            startBtn?.addEventListener('click', () => {
                openDock(true);
                setPhase('select');
                announce('ゲームを開始しました。お題を選択してください');
            });
            toggleDockBtn?.addEventListener('click', () => openDock(true));
            closeDockBtn?.addEventListener('click', () => openDock(false));
            hostFab?.addEventListener('click', () => openDock(true));

            // Mode selection
            qsa('input[name="mode"]').forEach(radio => {
                radio.addEventListener('change', (e)=>{
                    state.mode = e.target.value;
                });
            });
            qs('#decideModeBtn')?.addEventListener('click', () => {
                pickThemeByMode();
                setPhase('hint');
                qs('#shuffleBtn')?.removeAttribute('disabled');
                qs('#assignBtn')?.removeAttribute('disabled');
            });

            // Actions
            qs('#shuffleBtn')?.addEventListener('click', () => {
                shuffleCards();
                setPhase('arrange');
            });
            qs('#assignBtn')?.addEventListener('click', () => assignNumbersMock());
            qs('#lockHintsBtn')?.addEventListener('click', () => toggleHintsLock());
            qs('#nextPhaseBtn')?.addEventListener('click', () => {
                if (state.phase === 'hint') setPhase('arrange');
                else if (state.phase === 'arrange') setPhase('reveal');
                else setPhase('hint');
                announce(`フェーズを切り替え: ${state.phase}`);
            });
            qs('#resetRoundBtn')?.addEventListener('click', () => {
                timerReset(60);
                setPhase('select');
                announce('ラウンドをリセットしました');
            });
            qs('#endGameBtn')?.addEventListener('click', () => {
                setPhase('pre');
                openDock(false);
                announce('ゲームを終了しました');
            });

            // Timer buttons
            qs('#timerDisplay')?.addEventListener('dblclick', () => {
                const m = prompt('タイマー秒数を入力（例: 90）', '60');
                const sec = Math.max(0, parseInt(m || '60', 10));
                timerReset(sec);
            });
            qs('#timerStartBtn')?.addEventListener('click', timerStart);
            qs('#timerPauseBtn')?.addEventListener('click', timerPause);
            qs('#timerResetBtn')?.addEventListener('click', () => timerReset(60));

            // Initial
            updateTimer();
        });

    </script>

    <!-- Host Controls Dock -->
    <div class="host-dock" id="hostDock" hidden>
        <div class="dock-header">
            <div class="dock-title">
                <span class="led" id="dockLed"></span>
                ホストコントロール
            </div>
            <div class="phase-indicator" id="dockPhase">待機中</div>
            <button class="btn btn-ghost" id="closeDockBtn">閉じる</button>
        </div>
        <div class="dock-body">
            <div>
                <div class="dock-section-title">お題モード</div>
                <div class="segmented" id="modeSegment">
                    <input type="radio" name="mode" id="modeNormal" value="normal" checked>
                    <label for="modeNormal">通常</label>
                    <input type="radio" name="mode" id="modeRainbow" value="rainbow">
                    <label for="modeRainbow">レインボー</label>
                    <input type="radio" name="mode" id="modeClassic" value="classic">
                    <label for="modeClassic">クラシック</label>
                </div>
                <button class="btn btn-primary" id="decideModeBtn" style="margin-left:8px;">お題決定</button>
            </div>

            <div>
                <div class="dock-section-title">クイックアクション</div>
                <div class="dock-actions">
                    <button class="btn btn-secondary" id="shuffleBtn" disabled>シャッフル</button>
                    <button class="btn btn-secondary" id="assignBtn" disabled>番号配布</button>
                    <button class="btn btn-secondary" id="lockHintsBtn">ヒントロック</button>
                    <button class="btn btn-primary" id="nextPhaseBtn">次フェーズ</button>
                    <button class="btn btn-secondary" id="resetRoundBtn">ラウンドやり直し</button>
                    <button class="btn btn-danger" id="endGameBtn">終了</button>
                </div>
            </div>

            <div>
                <div class="dock-section-title">ラウンドタイマー</div>
                <div class="timer">
                    <span class="timer-display" id="timerDisplay">01:00</span>
                    <button class="btn btn-secondary" id="timerStartBtn">開始</button>
                    <button class="btn btn-secondary" id="timerPauseBtn">一時停止</button>
                    <button class="btn btn-secondary" id="timerResetBtn">リセット</button>
                </div>
            </div>
        </div>
    </div>

    <button class="host-fab" id="hostFab">⚙</button>

</body>
</html>