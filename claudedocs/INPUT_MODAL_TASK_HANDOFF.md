# Input Modal 実装依頼（ハンドオフ用）

## 目的
ホスト/参加者共通フッターをモーダル起動方式に刷新し、現行の常時入力フィールドを廃止する。スペースキーおよびフッターのショートカットボタンから連想ワード入力モーダルを呼び出し、UX と視認性を改善する。

## 現状
- `components/ui/MiniHandDock.tsx` は元の状態に戻してある（常時入力フィールドが存在）。
- 新規ファイル `components/ui/InputModal.tsx` と `components/ui/miniHandDockTokens.ts` は未使用の下書きとして残っている。必要に応じて使っても良いし、削除から再実装でも良い。
- スペースキーでモーダルを開く／Escで閉じる仕様は未実装。
- レイアウト要件（カードエリアを隠さず、ボタン群を分離するなど）は未着手。

## 要件（抜粋）
1. **呼び出し・閉じる動線**
   - スペースキー押下でモーダルを開く（スクロール抑止）。
   - フッター右下にコンパクトな「入力」ボタン（Space 表記付き）を配置し、クリックでも開ける。
   - 決定ボタン/Enter で送信しモーダル閉鎖。Esc/×ボタンでキャンセル閉鎖。
   - モーダル外クリックで閉じない。
2. **GSAP アニメーション**
   - 0.25〜0.35秒程度の scale + opacity 演出で入出。`prefers-reduced-motion` ではアニメ無効。
3. **ポータル**
   - `createPortal` で `document.body` 配下に描画。背景暗転なし。
   - フッターの高さを基準に `bottom: calc(footerHeight + 12px)` 前後へ固定。
4. **UI**
   - ドラクエ風ウィンドウ調。モノスペースフォントを使用。
   - 入力欄・決定・クリア・カード提出ボタンをモーダル内にまとめる。
   - カード提出ボタンは現行の `handleSubmit` ロジックを移植。
   - ホスト用ボタン（お題シャッフル・数字配り直し・リセット）はモーダル外に並べ、フッターの常時入力フィールドは削除。
5. **アクセシビリティ**
   - `role="dialog"`, ラベル付け。
   - モーダル表示時に入力欄へフォーカスし、閉じたら呼び出しボタンに戻す。
6. **入力処理**
   - 既存の `handleDecide`, `handleClear`, `handleSubmit`, `handleSubmitCustom` などのロジックをモーダルから呼び出す形に整理。
   - 送信成功時にトースト・サウンドなど現行挙動を維持。
7. **DPI 対応**
   - `rem`/`%` ベースで DPI 150% でもレイアウト崩れなし。

詳細要件は `claudedocs/INPUT_MODAL_TASK.md` を参照。

## 注意点
- ゲーム開始ボタンにモーダルやトリガーボタンが被らないよう `pointer-events` と配置を厳密に調整すること。
- Space→Esc→Space を繰り返してもフォーカスをクリックで戻す必要がないようにする（フォーカス制御とトリガー記憶が必須）。
- `MiniHandDock.tsx` の大幅なロジック変更になるため、型チェック（`npm run typecheck`）と必要なら `npm run build` で確認。

## 納品物
- 実装済みコード（主に `components/ui/MiniHandDock.tsx` と新設モーダルコンポーネント）。
- 既存ファイルの(remove/編集)を含む最小限の差分。
- テスト手順・確認結果（Space, Esc, ゲーム開始ボタンの動作など）。

## 連絡事項
- 既存の `components/ui/InputModal.tsx`, `components/ui/miniHandDockTokens.ts` はラフ状態。流用する場合は整備し、不要なら削除。
- 現在の master にはこれらファイルは未参照。自由に構成を決めて良い。

