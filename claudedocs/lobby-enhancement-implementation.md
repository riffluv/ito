# 🎯 コミュニティ投下対応ロビー強化システム実装指示書

## 📋 実装概要

**目的**: コミュニティ展開前にロビー機能を製品レベルに強化
**名称**: Room Discovery & Share System（部屋発見・共有システム）
**優先度**: HIGH - コミュニティ投下前の必須要件

## 🎯 実装する機能

### 1. 部屋表示制限（6件ページング）
- **現在**: 無制限表示（混雑時に見づらい）
- **改善**: 6件ずつページング表示
- **利点**: 視認性向上、パフォーマンス改善

### 2. 部屋検索機能
- **検索対象**: 部屋名・ホスト名
- **UI配置**: ロビー上部に検索バー
- **動作**: リアルタイム絞り込み

### 3. 部屋共有システム
- **共有URL**: `/r/{roomId}` → `/rooms/{roomId}`リダイレクト
- **招待コード**: 部屋作成後に表示
- **コピー機能**: ワンクリックでURL取得

## 🛠️ 技術仕様

### ファイル修正リスト

#### 1. `lib/hooks/useOptimizedRooms.ts`
```typescript
// 現在: limit(5)
// 変更: limit(6) + pagination対応
const ROOMS_PER_PAGE = 6;

export function useOptimizedRooms(page: number = 0, searchQuery?: string) {
  // ページネーション + 検索クエリ対応
}
```

#### 2. `app/page.tsx` - ロビーページ強化
```typescript
// 追加要素:
// - 検索バー（上部）
// - ページネーションボタン（下部）
// - グリッド: 2×3レイアウト（6件表示）
```

#### 3. `components/CreateRoomModal.tsx`
```typescript
// 部屋作成後の招待コード表示
const InviteCodeDisplay = ({ roomId }: { roomId: string }) => {
  const inviteUrl = `${window.location.origin}/r/${roomId}`;
  // コピー機能付きURL表示
};
```

#### 4. 新規ファイル: `app/r/[roomId]/route.ts`
```typescript
// リダイレクト処理
export async function GET(request: Request, { params }: { params: { roomId: string } }) {
  return NextResponse.redirect(`/rooms/${params.roomId}`);
}
```

#### 5. 新規コンポーネント: `components/ui/SearchBar.tsx`
```typescript
// ドラクエ風検索バー
// プレースホルダー: "部屋を さがす..."
// リアルタイム検索機能
```

#### 6. 新規コンポーネント: `components/ui/Pagination.tsx`
```typescript
// ドラクエ風ページネーション
// "まえへ" / "つぎへ" ボタン
// 現在ページ表示: "1 / 5 ページ"
```

## 🎨 UI/UX設計

### レイアウト構成
```
┌─────────────────────────────┐
│      🔍 検索バー           │
├─────────────────────────────┤
│  [部屋1] [部屋2] [部屋3]   │
│  [部屋4] [部屋5] [部屋6]   │
├─────────────────────────────┤
│    まえへ  1/5  つぎへ      │
└─────────────────────────────┘
```

### 招待コード表示
```
┌─────────────────────────────┐
│   ✅ ルームができました！   │
├─────────────────────────────┤
│ 招待URL:                    │
│ https://numberlink.vercel.app/r/abc123 │
│           [📋 コピー]       │
└─────────────────────────────┘
```

### ドラクエ風スタイル統一
- **背景**: `UI_TOKENS.COLORS.panelBg`
- **枠線**: `3px solid rgba(255,255,255,0.9)`
- **角**: `borderRadius: 0`
- **フォント**: `fontFamily: "monospace"`
- **影**: `UI_TOKENS.SHADOWS.panelDistinct`

## 🚀 実装手順

### Phase 1: 基礎機能（優先度: HIGH）
1. **部屋表示制限**: `useOptimizedRooms.ts` 修正
2. **グリッドレイアウト調整**: `app/page.tsx` 2×3グリッド
3. **基本ページネーション**: 前/次ボタン

### Phase 2: 検索・共有機能（優先度: HIGH）
1. **検索バー作成**: `SearchBar.tsx` 新規作成
2. **リアルタイム検索**: Firestore where句対応
3. **短縮URL**: `/r/{roomId}` リダイレクト実装

### Phase 3: UX向上（優先度: MEDIUM）
1. **招待コード表示**: CreateRoomModal拡張
2. **コピー機能**: クリップボードAPI
3. **検索結果ハイライト**: 検索語句強調表示

## 📝 実装時の注意点

### Firebase制約
- **検索**: `where()` + `orderBy()` の組み合わせ制約
- **ページング**: `startAfter()` cursor pagination推奨
- **リアルタイム**: `onSnapshot` でリアルタイム更新維持

### パフォーマンス
- **遅延ローディング**: 検索クエリ debounce (300ms)
- **キャッシュ**: React Query で結果キャッシュ
- **無限スクロール**: 将来的な拡張考慮

### ドラクエ風デザイン統一
- **全コンポーネント**: 既存UIトークン使用必須
- **アニメーション**: GSAP で統一感のある動作
- **メッセージ**: ひらがな多用「さがしています...」

## 🧪 テスト項目

### 動作確認
- [ ] 6件表示制限が正常動作
- [ ] ページネーション動作（前/次）
- [ ] 検索フィルタリング動作
- [ ] 招待URL生成・リダイレクト
- [ ] コピー機能動作

### UI確認
- [ ] ドラクエ風デザイン統一
- [ ] レスポンシブ対応（SP/PC）
- [ ] ローディング状態表示
- [ ] エラー状態ハンドリング

## 🎯 完成の定義

1. **機能完成**: 6件ページング + 検索 + 共有URL
2. **デザイン統一**: 全要素がドラクエ風UI準拠
3. **パフォーマンス**: 100件以上の部屋でもスムーズ動作
4. **ユーザビリティ**: 直感的操作で部屋発見・参加可能

## 💭 将来拡張案

- **お気に入り部屋**: ブックマーク機能
- **部屋カテゴリ**: 初心者向け・上級者向け分類
- **プライベート部屋**: パスワード保護機能
- **部屋統計**: 人気部屋ランキング

## 🧠 実装者への重要指針

### **自発的判断を推奨**
- **この指示書は参考案です** - より良いアプローチがあれば遠慮なく変更してください
- **bad practice を避ける**: 指定通りに実装するより、技術的に正しい方法を優先
- **実装者の都合に合わせる**: Next.js/Firebase のベストプラクティスに従ってください
- **設計改善歓迎**: この提案より優秀な設計があれば採用してください

### **変更OK要素**
- **ファイル構成**: より良いディレクトリ構造があれば変更OK
- **API設計**: より効率的なFirestoreクエリがあれば変更OK
- **UI実装**: より使いやすいUXがあれば変更OK
- **技術選択**: より適切なライブラリ・手法があれば変更OK

### **変更NG要素**
- **基本要件**: 6件ページング・検索・招待URL は必須機能
- **デザイン統一**: ドラクエ風UIトークンは維持必須
- **ユーザー体験**: 直感的な操作感は維持必須

**重要**: 実装中に「これは微妙だな」と思ったら、遠慮なく改善してください。完璧を追求するより、実用的で保守しやすいコードを書くことが最優先です。

---

**実装目標**: コミュニティ投下時に「使いやすいロビー」として評価される製品レベルの完成度

**推定工数**: 3-5日（Phase 1-2の基本機能完成）

**実装スタンス**: 指示書に縛られず、技術的に最適な解決策を選択してください