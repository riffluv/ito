<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ITO ‚Äì Party Mode</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700;900&display=swap" rel="stylesheet"/>
  <style>
    /* --- RESET & TOKENS --------------------------------------------------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{block-size:100%;}
    :root{
      /* brand */
      --primary:#ff6b35; --secondary:#4ecdc4; --accent:#ffe66d; --blue:#4a90e2; --success:#2ecc71; --warning:#f39c12; --danger:#e74c3c;
      /* surfaces */
      --bg-0:#0e1525; --bg-1:#141a2b; --bg-2:#1a2135; --text:#fff; --muted:#b7c0ce;
      /* radii/shadow */
      --r-lg:20px; --r-md:14px; --r-sm:10px; --shadow:0 20px 40px rgba(0,0,0,.35);
      /* safe areas */
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    body{
      margin:0; font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      color:var(--text);
      /* Use dynamic viewport height to avoid browser-UI jump & stray scrollbars */
      min-block-size:100svh; /* fallback for older */
      background: radial-gradient(1200px 600px at 10% 80%, rgba(255,107,53,.12), transparent 60%),
                  radial-gradient(1200px 600px at 90% 10%, rgba(78,205,196,.12), transparent 60%),
                  linear-gradient(135deg, var(--bg-1), var(--bg-2));
      overflow: clip; /* no body scroll; we will scroll inner panes if needed */
    }
    @supports (min-height: 100dvh){ body{ min-block-size:100dvh; } }

    .app{
      /* full-height grid. "minmax(0,1fr)" prevents children overflow from creating scroll */
      block-size:100%;
      display:grid;
      grid-template-areas:
        "header header header"
        "players main timer"
        "board   board board"
        "hand    hand  hand";
      grid-template-columns: 18rem minmax(0,1fr) 18rem;
      grid-template-rows: auto minmax(0,1fr) auto auto;
      gap:16px; padding:16px;
      max-inline-size:1400px; margin-inline:auto;
      padding-top: calc(16px + var(--safe-top));
      padding-bottom: calc(16px + var(--safe-bottom));
    }

    /* shared card surface */
    .surface{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); backdrop-filter: blur(14px);
      border-radius:var(--r-lg); box-shadow:var(--shadow); min-block-size:0; /* let inside scroll */}

    /* --- HEADER ------------------------------------------------------------ */
    .header{grid-area:header; display:flex; align-items:center; justify-content:space-between; padding:16px 18px; position:relative; overflow:hidden}
    .brand{display:flex; align-items:center; gap:12px; font-weight:900; letter-spacing:.6px; font-size:clamp(20px,2.4vw,28px);
      background:linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .brand::before{content:"üéÆ"; font-size:1.2em}

    .actions{display:flex; gap:10px; flex-wrap:wrap}
    button{font:inherit; color:#0f1422; background:rgba(255,255,255,.2); border:1px solid rgba(255,255,255,.24); border-radius:12px; padding:10px 14px; cursor:pointer; transition:transform .12s ease, box-shadow .2s ease, background .2s ease; position:relative}
    button:focus-visible{outline:3px solid color-mix(in oklab, white 50%, var(--secondary)); outline-offset:2px}
    .btn--ghost{color:#fff; background:rgba(255,255,255,.08)}
    .btn--primary{color:#fff; background:linear-gradient(135deg, var(--primary), #ff8a50); box-shadow:0 10px 26px rgba(255,107,53,.35)}
    .btn--secondary{background:linear-gradient(135deg, var(--secondary), #6eddd6)}
    button:hover{transform:translateY(-1px)}

    /* --- LEFT: PLAYERS ----------------------------------------------------- */
    .players{grid-area:players; padding:18px}
    .title{color:var(--accent); font-weight:700; margin-block:2px 12px}
    .player{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:12px; border-radius:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);}
    .player+.player{margin-top:10px}
    .badge{font-size:12px; font-weight:700; color:#0e1525; padding:6px 10px; border-radius:999px; text-transform:uppercase; letter-spacing:.3px}
    .is-ready{background:linear-gradient(135deg,var(--success),#27ae60); color:#fff}
    .is-wait{background:linear-gradient(135deg,var(--warning),#e67e22); color:#fff}
    .is-play{background:linear-gradient(135deg,var(--blue),#5dade2); color:#fff}

    .opts{margin-top:18px}
    .opts .btn{inline-size:100%}

    /* --- CENTER: MAIN ------------------------------------------------------ */
    .main{grid-area:main; display:flex; flex-direction:column; overflow:hidden}
    .main__top{background:linear-gradient(135deg,var(--primary),var(--accent)); padding:14px 18px; border-start-start-radius:var(--r-lg); border-start-end-radius:var(--r-lg)}
    .round{font-weight:800}
    .main__body{padding:28px 20px; display:grid; place-items:center; text-align:center; gap:14px; overflow:auto; min-block-size:0}
    .topic{font-weight:900; line-height:1.15; font-size:clamp(22px,2.8vw,34px); background:linear-gradient(135deg,var(--primary),var(--secondary),var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
    .topic-sub{color:var(--muted)}
    .hints{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:4px}
    .hint{background:linear-gradient(135deg,#b06ab3,#c39bd3); color:#fff; padding:8px 14px; border-radius:999px; font-weight:700}

    /* --- RIGHT: TIMER ------------------------------------------------------ */
    .timer{grid-area:timer; padding:18px; display:flex; flex-direction:column; align-items:center; text-align:center}
    .time{font-weight:900; font-size:clamp(28px,4vw,44px); color:var(--accent); text-shadow:0 0 18px var(--accent)}
    .tbar{inline-size:100%; block-size:8px; background:rgba(255,255,255,.12); border-radius:999px; overflow:hidden; margin-block:10px}
    .tprog{block-size:100%; inline-size:60%; background:linear-gradient(90deg, var(--accent), var(--warning)); transition:width 1s linear}

    /* --- BOARD ------------------------------------------------------------- */
    .board{grid-area:board; padding:22px}
    .board h2{color:var(--secondary); text-align:center; margin:0 0 14px; font-weight:800}
    .dropzone{min-block-size:180px; display:grid; grid-template-columns:repeat(auto-fit,minmax(80px,1fr)); gap:14px; align-items:start; justify-items:center; padding:18px; border-radius:14px; border:2px dashed rgba(255,255,255,.22); background:
      radial-gradient(circle at 30% 70%, rgba(78,205,196,.12) 0%, transparent 50%),
      repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0px, rgba(255,255,255,.02) 10px, transparent 10px, transparent 20px);
      overflow:auto}
    .dropzone::before{content:'üéØ „Ç´„Éº„Éâ„Çí„Åì„Åì„Å´ÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'; color:var(--muted); font-weight:700; opacity:.75}
    .dropzone:not(:empty)::before{display:none}
    .dropzone.drag{border-color:var(--secondary); background:rgba(78,205,196,.08)}

    .card{aspect-ratio:2/3; inline-size:84px; border-radius:12px; border:2px solid #3498db; background:linear-gradient(145deg,#2c3e50,#34495e); display:grid; place-items:center; position:relative; cursor:grab; box-shadow:0 12px 28px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.12); overflow:hidden}
    .card:hover{transform:translateY(-6px) scale(1.03)}
    .card:active{cursor:grabbing}
    .card::after{content:""; position:absolute; inset:-50% auto auto -50%; inline-size:200%; block-size:200%; background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,.12) 50%, transparent 70%); transform:rotate(45deg)}
    .card .num{font-weight:900; font-size:1.8rem; text-shadow:0 2px 8px rgba(0,0,0,.5)}
    .card .order{position:absolute; inset: -8px -8px auto auto; inline-size:28px; block-size:28px; border-radius:50%; border:3px solid #fff; display:grid; place-items:center; font-weight:900; font-size:14px; color:#0e1525; background:linear-gradient(135deg,var(--accent),var(--warning));}
    .card .who{position:absolute; inset:auto 50% -6px 50%; transform:translateX(-50%); font-size:10px; font-weight:700; padding:4px 10px; border-radius:10px; color:#fff; border:1px solid var(--secondary); background:var(--bg-2)}
    .card.hidden .num{filter:blur(8px); opacity:.3}
    .card.hidden::before{content:'?'; position:absolute; inset:0; display:grid; place-items:center; font-weight:900; font-size:2rem; color:var(--secondary); text-shadow:0 0 16px var(--secondary)}

    /* --- HAND -------------------------------------------------------------- */
    .hand{grid-area:hand; padding:18px; display:flex; gap:20px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .my{display:flex; align-items:center; gap:14px}
    .my .label{color:var(--accent); font-weight:800}
    .my .mine{aspect-ratio:2/3; inline-size:100px; border-radius:12px; border:3px solid #ffd700; background:linear-gradient(145deg,var(--primary),var(--accent)); display:grid; place-items:center; box-shadow:0 14px 34px rgba(255,107,53,.4), 0 0 40px rgba(255,230,109,.35); cursor:grab}
    .mine .num{font-weight:900; font-size:2.1rem; color:#0e1525}

    .word{flex:1; display:flex; align-items:center; gap:10px; min-inline-size:min(420px,100%)}
    .word input{flex:1; padding:12px 14px; border-radius:12px; border:2px solid rgba(255,255,255,.22); background:rgba(255,255,255,.08); color:#fff; font-weight:700}
    .word input::placeholder{color:var(--muted)}

    .status{font-size:12px; font-weight:800; padding:6px 10px; border-radius:999px}
    .status.wait{background:linear-gradient(135deg,var(--warning),#e67e22); color:#fff}
    .status.ready{background:linear-gradient(135deg,var(--success),#27ae60); color:#fff}

    /* a11y: cut the motion if user prefers */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important; scroll-behavior:auto !important}
    }

    /* RESPONSIVE LAYOUTS */
    @media (max-width: 1000px){
      .app{grid-template-areas:
        "header header"
        "main    main"
        "players timer"
        "board   board"
        "hand    hand";
        grid-template-columns: 1fr 1fr;}
    }
    @media (max-width: 640px){
      .app{grid-template-areas:
        "header"
        "main"
        "players"
        "timer"
        "board"
        "hand";
        grid-template-columns: 1fr;}
      .hand{flex-direction:column; align-items:stretch}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="ITO party game">
    <!-- HEADER -->
    <header class="surface header">
      <div class="brand">ITO</div>
      <div class="actions">
        <button type="button" class="btn btn--ghost" id="dealBtn">„Ç´„Éº„Éâ„ÇíÈÖç„Çã</button>
        <button type="button" class="btn btn--ghost" id="revealBtn">ÂÖ®ÈÉ®„ÇÅ„Åè„Çã</button>
        <button type="button" class="btn btn--secondary" id="resetBtn">„É™„Çª„ÉÉ„Éà</button>
        <button type="button" class="btn btn--primary" id="readyBtn">Ê∫ñÂÇôOK</button>
      </div>
    </header>

    <!-- PLAYERS -->
    <aside class="surface players">
      <div class="title">üë• „Éó„É¨„Ç§„É§„Éº (3/3)</div>
      <div class="player"><span class="name">„ÅÇ„Åç</span><span class="badge is-wait" id="player1Status">Êú™ÈÖçÂ∏É</span></div>
      <div class="player"><span class="name">chromeÈÄöÂ∏∏</span><span class="badge is-wait" id="player2Status">Êú™ÈÖçÂ∏É</span></div>
      <div class="player"><span class="name">„Ç®„ÉÉ„Ç∏„Åß„Åô„ÄÇ</span><span class="badge is-wait" id="player3Status">Êú™ÈÖçÂ∏É</span></div>

      <div class="opts" style="margin-top:14px">
        <div class="title" style="margin:0 0 10px">‚öôÔ∏è „Ç™„Éó„Ç∑„Éß„É≥</div>
        <button type="button" class="btn btn--ghost" id="botBtn" style="inline-size:100%; margin-bottom:10px">È†ÜÁï™„Å´</button>
        <button type="button" class="btn btn--ghost" id="undoBtn" style="inline-size:100%">„Åõ„Éº„ÅÆ„ÅßÔºÅ</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="surface main">
      <div class="main__top"><div class="round">üéÆ „É©„Ç¶„É≥„Éâ 1 | „Ç´„ÉÜ„Ç¥„É™: ÈõëË´áÁ≥ª</div></div>
      <div class="main__body">
        <h1 class="topic" id="topicDisplay">„ÅäÈ°åÔºö„Ç¢„Éã„É°„ÉªÊº´Áîª„ÅÆ„Ç≠„É£„É©„ÅÆÂº∑„Åï</h1>
        <p class="topic-sub">„ÄåÂº±„ÅÑ ‚Üí Âº∑„ÅÑ„Äç„ÅÆÈ†Ü„Åß„Ç´„Éº„Éâ„ÇíÂ†¥„Å´Âá∫„Åù„ÅÜÔºàÂêÑËá™1ÊûöÔºâ„ÄÇ</p>
        <div class="hints" id="hintsContainer"></div>
        <button type="button" class="btn btn--ghost" id="topicBtn" style="margin-top:8px">„ÅäÈ°åÂ§âÊõ¥</button>
      </div>
    </main>

    <!-- TIMER -->
    <aside class="surface timer">
      <div class="title">‚è∞ Áõ∏Ë´áÊôÇÈñì</div>
      <div class="time" id="timerDisplay">40</div>
      <div class="tbar"><div class="tprog" id="timerProgress"></div></div>
      <div style="color:var(--muted); font-size:.9rem">Áßí</div>
    </aside>

    <!-- BOARD -->
    <section class="surface board">
      <h2>üéØ „Ç´„Éº„Éâ„Éú„Éº„ÉâÔºàÂá∫„Åó„ÅüÈ†ÜÔºâ</h2>
      <div class="dropzone" id="cardBoard" aria-live="polite"></div>
      <p style="text-align:center; margin-top:12px; color:var(--muted); font-size:.9rem">‰ºè„Åõ„Åü„Åæ„Åæ‰∏¶„Åπ„Å¶„ÄÅÊúÄÂæå„Å´„ÇÅ„Åè„Å£„Å¶ÁµêÊûúÂà§ÂÆö</p>
    </section>

    <!-- HAND -->
    <footer class="surface hand">
      <div class="my">
        <div class="label">üÉè „ÅÇ„Å™„Åü„ÅÆ„Ç´„Éº„Éâ</div>
        <div class="mine hidden" id="myCard" draggable="true" aria-grabbed="false"><div class="num" id="myCardNumber">--</div></div>
        <div style="display:flex; flex-direction:column; gap:8px">
          <button type="button" class="btn btn--primary" id="playBtn">„Ç´„Éº„Éâ„ÇíÂá∫„Åô</button>
          <button type="button" class="btn btn--ghost" id="takeBackBtn" disabled>Âèñ„ÇäÊ∂à„Åó</button>
        </div>
      </div>
      <div class="word">
        <input id="wordInput" type="text" placeholder="üí≠ ÈÄ£ÊÉ≥„ÉØ„Éº„Éâ„ÇíÂÖ•ÂäõÔºà‰æãÔºö„Éî„Ç´„ÉÅ„É•„Ç¶„ÄÅÊÇüÁ©∫Ôºâ" maxlength="20"/>
        <button type="button" class="btn btn--secondary" id="submitWordBtn">ÈÄÅ‰ø°</button>
        <span class="status wait" id="wordStatus">Êú™ÂÖ•Âäõ</span>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" aria-live="polite" style="position:fixed; inset: max(16px, var(--safe-top)) auto auto 50%; transform:translateX(-50%); padding:14px 18px; border-radius:12px; background:linear-gradient(135deg,var(--blue),#5dade2); color:#fff; font-weight:800; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:opacity .25s ease"></div>

  <script>
    // ===== „Ç≤„Éº„É†Áä∂ÊÖã =====
    const gameState = {
      players:[
        { id:1, name:"„ÅÇ„Åç", number:null, word:"", played:false },
        { id:2, name:"chromeÈÄöÂ∏∏", number:null, word:"", played:false },
        { id:3, name:"„Ç®„ÉÉ„Ç∏„Åß„Åô„ÄÇ", number:null, word:"", played:false },
      ],
      currentPlayer:1,
      timer:40,
      timerInterval:null
    };

    // ===== Ë¶ÅÁ¥†ÂèÇÁÖß =====
    const el = {
      myCard: document.getElementById('myCard'),
      myNum: document.getElementById('myCardNumber'),
      board: document.getElementById('cardBoard'),
      hints: document.getElementById('hintsContainer'),
      wordInput: document.getElementById('wordInput'),
      wordStatus: document.getElementById('wordStatus'),
      timerDisplay: document.getElementById('timerDisplay'),
      timerProgress: document.getElementById('timerProgress'),
      topic: document.getElementById('topicDisplay'),
      toast: document.getElementById('toast'),
      playerStatuses:[null, document.getElementById('player1Status'), document.getElementById('player2Status'), document.getElementById('player3Status')]
    };

    // ===== „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ =====
    const toast=(msg,type='info')=>{
      el.toast.textContent = msg; el.toast.style.opacity = 1;
      if(type==='success') el.toast.style.background = 'linear-gradient(135deg, var(--success), #27AE60)';
      if(type==='error')   el.toast.style.background = 'linear-gradient(135deg, var(--danger), #c0392b)';
      if(type==='info')    el.toast.style.background = 'linear-gradient(135deg, var(--blue), #5dade2)';
      clearTimeout(el.toast._t); el.toast._t=setTimeout(()=>{el.toast.style.opacity=0}, 2200);
    };

    const setStatus=(id, text, cls)=>{ const s=el.playerStatuses[id]; if(!s) return; s.textContent=text; s.className = 'badge ' + cls; };

    const uniqueNumbers=(min,max,count)=>{
      const arr=[...Array(max-min+1).keys()].map(n=>n+min);
      for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}
      return arr.slice(0,count);
    };

    const cardEl=(p, hidden=true)=>{
      const d=document.createElement('div');
      d.className='card'+(hidden?' hidden':''); d.dataset.playerId=p.id; d.dataset.number=p.number; d.draggable=false;
      d.innerHTML=`<div class="num">${p.number}</div><div class="order"></div><div class="who">${p.name}</div>`;
      return d;
    };

    const refreshOrders=()=>{ [...el.board.querySelectorAll('.card')].forEach((c,i)=>{ c.querySelector('.order').textContent = i+1; }); };

    const refreshHints=()=>{ el.hints.innerHTML=''; gameState.players.forEach(p=>{ if(p.word.trim()){ const h=document.createElement('div'); h.className='hint'; h.textContent=`${p.name}: ${p.word}`; el.hints.appendChild(h);} }); };

    // ===== „Çø„Ç§„Éû„Éº =====
    const startTimer=()=>{
      clearInterval(gameState.timerInterval);
      gameState.timer=40; el.timerDisplay.textContent=gameState.timer; el.timerProgress.style.width='100%';
      gameState.timerInterval=setInterval(()=>{
        gameState.timer--; el.timerDisplay.textContent=gameState.timer; el.timerProgress.style.width=`${(gameState.timer/40)*100}%`;
        if(gameState.timer<=0){ gameState.timer=40; el.timerDisplay.textContent=gameState.timer; el.timerProgress.style.width='100%'; }
      },1000);
    };

    // ===== „Ç≤„Éº„É†Âãï‰Ωú =====
    document.getElementById('dealBtn').addEventListener('click',()=>{
      const nums=uniqueNumbers(1,100,gameState.players.length);
      gameState.players.forEach((p,i)=>{ p.number=nums[i]; p.played=false; p.word=''; setStatus(p.id,'ÈÖçÂ∏ÉÊ∏à„Åø','is-ready'); });
      const me=gameState.players.find(p=>p.id===gameState.currentPlayer);
      el.myNum.textContent=me.number; el.myCard.classList.remove('hidden');
      el.board.innerHTML=''; el.hints.innerHTML=''; el.wordInput.value=''; el.wordStatus.textContent='Êú™ÂÖ•Âäõ'; el.wordStatus.className='status wait'; document.getElementById('takeBackBtn').disabled=true;
      toast('üé¥ „Ç´„Éº„Éâ„ÅåÈÖç„Çâ„Çå„Åæ„Åó„ÅüÔºÅ','success'); startTimer();
    });

    const play=(p)=>{ if(!p.number||p.played) return; p.played=true; const c=cardEl(p,true); el.board.appendChild(c); refreshOrders(); setStatus(p.id,'Âá∫„Åó„Åü','is-play'); if(p.id===gameState.currentPlayer){ document.getElementById('takeBackBtn').disabled=false; toast('‚ú® „Ç´„Éº„Éâ„ÇíÂá∫„Åó„Åæ„Åó„ÅüÔºÅ','success'); } };
    document.getElementById('playBtn').addEventListener('click',()=>{ play(gameState.players.find(p=>p.id===gameState.currentPlayer)); });

    // DnD
    el.myCard.addEventListener('dragstart',(e)=>{ e.dataTransfer.setData('text/plain', String(gameState.currentPlayer)); el.myCard.style.opacity='.6'; });
    el.myCard.addEventListener('dragend',()=>{ el.myCard.style.opacity='1'; });
    el.board.addEventListener('dragover',(e)=>{ e.preventDefault(); el.board.classList.add('drag'); });
    el.board.addEventListener('dragleave',()=>{ el.board.classList.remove('drag'); });
    el.board.addEventListener('drop',(e)=>{ e.preventDefault(); el.board.classList.remove('drag'); const me=gameState.players.find(p=>p.id===gameState.currentPlayer); if(me && !me.played) play(me); });

    // Âèñ„ÇäÊ∂à„Åó
    document.getElementById('takeBackBtn').addEventListener('click',()=>{
      const cards=el.board.querySelectorAll('.card'); const last=cards[cards.length-1]; if(!last) return;
      const pid=Number(last.dataset.playerId); if(pid!==gameState.currentPlayer) return; const p=gameState.players.find(x=>x.id===pid);
      p.played=false; last.remove(); refreshOrders(); setStatus(pid,'ÈÖçÂ∏ÉÊ∏à„Åø','is-ready'); document.getElementById('takeBackBtn').disabled=true; toast('‚Ü©Ô∏è „Ç´„Éº„Éâ„ÇíÂèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü','info');
    });

    // ÂÖ®‰ΩìÂèñ„ÇäÊ∂à„ÅóÔºàÊúÄÂæå„ÅÆ1ÊûöÔºâ
    document.getElementById('undoBtn').addEventListener('click',()=>{
      const cards=el.board.querySelectorAll('.card'); const last=cards[cards.length-1]; if(!last) return;
      const pid=Number(last.dataset.playerId); const p=gameState.players.find(x=>x.id===pid); p.played=false; last.remove(); refreshOrders(); setStatus(pid,'ÈÖçÂ∏ÉÊ∏à„Åø','is-ready'); if(pid===gameState.currentPlayer) document.getElementById('takeBackBtn').disabled=true; toast('‚Ü©Ô∏è ÊúÄÂæå„ÅÆ„Ç´„Éº„Éâ„ÇíÂèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü','info');
    });

    // „ÇÅ„Åè„Çã
    document.getElementById('revealBtn').addEventListener('click',()=>{
      const cards=[...el.board.querySelectorAll('.card')]; if(!cards.length){ toast('‚ùå „Åæ„Å†„Ç´„Éº„Éâ„ÅåÂá∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì','error'); return; }
      cards.forEach(c=>c.classList.remove('hidden'));
      const nums=cards.map(c=>Number(c.dataset.number));
      const ok=nums.every((n,i)=> i===0 || nums[i-1] < n);
      setTimeout(()=>{
        if(ok){ toast('üéâ ÊàêÂäüÔºÅÔºÅ ÂÆåÁíß„Å™È†ÜÂ∫è„Åß„ÅôÔºÅ','success'); gameState.players.forEach(p=>{ if(p.played) setStatus(p.id,'ÊàêÂäü','is-ready'); }); }
        else { toast('üí• Â§±Êïó... È†ÜÂ∫è„ÅåÈÅï„ÅÑ„Åæ„Åô','error'); gameState.players.forEach(p=>{ if(p.played) setStatus(p.id,'Â§±Êïó','is-wait'); }); }
      }, 400);
    });

    // ÈÄ£ÊÉ≥„ÉØ„Éº„Éâ
    document.getElementById('submitWordBtn').addEventListener('click',()=>{
      const w=el.wordInput.value.trim(); if(!w){ toast('‚ùó „ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ','error'); return; }
      const me=gameState.players.find(p=>p.id===gameState.currentPlayer); me.word=w; el.wordStatus.textContent=w; el.wordStatus.className='status ready'; refreshHints(); toast('üí≠ „ÉØ„Éº„Éâ„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ','success');
    });
    el.wordInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') document.getElementById('submitWordBtn').click(); });

    // „ÅäÈ°åÂ§âÊõ¥Ôºà‰∏çÊ≠£„Å™„ÇØ„Ç©„Éº„Éà„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÉÜ„É≥„Éó„É¨„Éº„ÉàÊñáÂ≠óÂàó„ÅßÔºâ
    const topics = [
      `„ÅäÈ°åÔºö„Ç¢„Éã„É°„ÉªÊº´Áîª„ÅÆ„Ç≠„É£„É©„ÅÆÂº∑„Åï`,
      `„ÅäÈ°åÔºö„Ç¢„Ç§„Çπ„ÅÆ„Äå„Åï„Å£„Å±„ÇäÂ∫¶„Äç`,
      `„ÅäÈ°åÔºö„Éõ„É©„ÉºÊò†Áîª„ÅÆ„ÄåÊÄñ„Åï„Äç`,
      `„ÅäÈ°åÔºöÂãïÁâ©„ÅÆ„Äå‰øäÊïè„Åï„Äç`,
      `„ÅäÈ°åÔºöÊñôÁêÜ„ÅÆ„ÄåËæõ„Åï„Äç`,
      `„ÅäÈ°åÔºö‰πó„ÇäÁâ©„ÅÆ„ÄåÈÄü„Åï„Äç`,
      `„ÅäÈ°åÔºöÊ•ΩÂô®„ÅÆ„ÄåÈü≥„ÅÆÈ´ò„Åï„Äç`,
      `„ÅäÈ°åÔºöÂª∫Áâ©„ÅÆ„ÄåÈ´ò„Åï„Äç`,
    ];
    document.getElementById('topicBtn').addEventListener('click',()=>{
      const cur=el.topic.textContent; let next;
      do{ next = topics[Math.floor(Math.random()*topics.length)]; } while(next===cur);
      el.topic.textContent = next; toast('üéØ „ÅäÈ°å„ÅåÂ§âÊõ¥„Åï„Çå„Åæ„Åó„Åü','info');
    });

    // BOTÔºà„Éá„É¢Ôºâ
    let botInterval=null; document.getElementById('botBtn').addEventListener('click',()=>{
      if(botInterval){ clearInterval(botInterval); botInterval=null; toast('ü§ñ BOTÂÅúÊ≠¢','info'); return; }
      const others=gameState.players.filter(p=>p.id!==gameState.currentPlayer);
      const playable=others.filter(p=>!p.played && p.number); if(!playable.length){ toast('‚ùå BOT„ÅåÂá∫„Åõ„Çã„Ç´„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì','error'); return; }
      toast('ü§ñ BOTËá™Âãï„Éó„É¨„Ç§ÈñãÂßã','info');
      botInterval=setInterval(()=>{
        const alive=others.filter(p=>!p.played && p.number); if(!alive.length){ clearInterval(botInterval); botInterval=null; return; }
        const p=alive[Math.floor(Math.random()*alive.length)]; if(!p.word){ const samples=['Âº∑Êïµ','‰∏≠Á¥ö','ÂàùÁ¥ö','ÊúÄÂº∑','ÊôÆÈÄö']; p.word=samples[Math.floor(Math.random()*samples.length)]; refreshHints(); }
        play(p);
      }, 1800);
    });

    // ÂàùÊúü
    startTimer(); toast('üéÆ ITO „Ç≤„Éº„É†„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ','success');
  </script>
</body>
</html>
