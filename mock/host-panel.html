<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ホスト用パネル・モック（開始→カテゴリ→配る）</title>
    <style>
      :root {
        --bg: #0b1020;
        --panel: #121933;
        --card: #18244d;
        --text: #e5e7eb;
        --muted: #a7b0c0;
        --accent: #3b82f6; /* デフォ: 通常 */
        --danger: #ef4444;
        --gap-1: 8px; --gap-2: 16px; --gap-3: 24px; --gap-4: 32px;
      }
      body { margin: 0; background: var(--bg); color: var(--text); font: 14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "ヒラギノ角ゴ ProN", Meiryo, sans-serif; }
      .container { max-width: 1100px; margin: 0 auto; padding: var(--gap-3); }

      /* トップバー */
      .topbar { position: sticky; top: 0; z-index: 10; background: linear-gradient(0deg, rgba(11,16,32,0.3), rgba(11,16,32,0.9)); backdrop-filter: blur(6px); border-bottom: 1px solid rgba(255,255,255,0.06); }
      .topbar-inner { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: var(--gap-2); padding: var(--gap-2) 0; }
      .progress { color: var(--muted); font-variant-numeric: tabular-nums; }
      .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); color: #fff; font-weight: 700; }

      /* カテゴリ・チューザー */
      .chooser { display: grid; place-items: center; min-height: 48vh; text-align: center; }
      .chooser h2 { margin: 0 0 10px; color: var(--muted); letter-spacing: .3px; font-size: 18px; }
      .chooser-grid { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }
      .tile { appearance: none; border: 1px solid rgba(255,255,255,0.12); background: #0f1838; color: #e8eefc; padding: 16px 20px; border-radius: 12px; font-weight: 800; font-size: 16px; letter-spacing: .3px; cursor: pointer; min-width: 160px; transition: transform .03s ease, background .15s; }
      .tile:hover { background: #12204a; }
      .tile:active { transform: translateY(1px); }

      /* ステージ */
      .stage { display: grid; grid-template-columns: 1fr 320px; gap: var(--gap-3); align-items: start; margin-top: var(--gap-3); }
      .number-wrap { display: grid; place-items: center; min-height: 320px; background: var(--panel); border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; position: relative; }
      .number { width: 220px; height: 220px; border-radius: 50%; display: grid; place-items: center; font-size: 72px; font-weight: 800; color: white; background: radial-gradient(circle at 30% 30%, #ffffff, var(--accent)); box-shadow: 0 10px 30px rgba(0,0,0,0.4); transform: translateZ(0); }
      .number.bump { animation: bump 520ms cubic-bezier(.2,.8,.2,1); }
      @keyframes bump { 0%{ transform: scale(.8); } 60%{ transform: scale(1.12); } 100%{ transform: scale(1); } }
      .empty-hint { color: var(--muted); font-size: 13px; margin-top: 10px; }

      .side { display: grid; gap: var(--gap-2); }
      .card { background: var(--card); border: 1px solid rgba(255,255,255,0.06); border-radius: 14px; padding: var(--gap-2); }
      .card h3 { margin: 0 0 6px; font-size: 14px; color: var(--muted); font-weight: 700; letter-spacing: .4px; }
      .topic { font-size: 20px; font-weight: 800; letter-spacing: .2px; }
      .topic-cat { display: inline-block; margin-top: 4px; font-size: 12px; color: var(--muted); }
      .history { display: flex; flex-wrap: wrap; gap: 8px; }
      .chip { padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); color: #fff; font-variant-numeric: tabular-nums; background: rgba(255,255,255,0.05); }

      /* ドック（ホスト下部操作帯） */
      .dock { position: sticky; bottom: 0; margin-top: var(--gap-3); background: linear-gradient(180deg, rgba(18,25,51,0), rgba(18,25,51,.9)); border-top: 1px solid rgba(255,255,255,0.06); padding: var(--gap-2) 0; }
      .dock-inner { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: var(--gap-2); }
      .dock-left, .dock-right { display: flex; gap: 8px; align-items: center; justify-content: flex-start; }
      .dock-right { justify-content: flex-end; }

      /* ボタン */
      .btn { appearance: none; border: 1px solid rgba(255,255,255,0.12); background: #0f1838; color: #e8eefc; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: transform .03s ease, background .15s; }
      .btn:hover { background: #12204a; }
      .btn:active { transform: translateY(1px); }
      .btn[disabled] { opacity: .5; cursor: not-allowed; }
      .btn.primary { border: 0; background: var(--accent); color: #fff; box-shadow: 0 10px 18px rgba(59,130,246,.25); padding: 14px 22px; font-size: 18px; border-radius: 999px; }
      .btn.danger { border-color: rgba(239,68,68,.4); color: #fff; background: rgba(239,68,68,.15); }
      .btn.danger:hover { background: rgba(239,68,68,.22); }

      /* ウェルカム */
      .welcome { display: grid; place-items: center; min-height: 48vh; text-align: center; }
      .welcome h1 { margin: 0 0 var(--gap-2); font-size: 28px; letter-spacing: .5px; }

      /* モーダル（<dialog>） */
      dialog { border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 0; background: var(--panel); color: var(--text); }
      dialog::backdrop { background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
      .dlg-head { padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.08); font-weight: 700; }
      .dlg-body { padding: 14px 16px; display: grid; gap: 12px; }
      .dlg-foot { padding: 12px 16px; display: flex; gap: 8px; justify-content: flex-end; border-top: 1px solid rgba(255,255,255,0.08); }
      .topic-list { display: grid; gap: 8px; max-height: 40vh; overflow: auto; }
      .topic-item { display: flex; align-items: center; gap: 8px; padding: 6px 8px; border-radius: 8px; background: rgba(255,255,255,0.04); cursor: pointer; }
      .topic-item input { accent-color: var(--accent); }
      .segment { display: inline-flex; background: #0e1633; border: 1px solid rgba(255,255,255,0.1); border-radius: 999px; overflow: hidden; }
      .segment button { appearance: none; border: 0; padding: 8px 14px; color: var(--muted); background: transparent; cursor: pointer; font-weight: 700; letter-spacing: .2px; }
      .segment button[aria-pressed="true"] { color: #fff; background: var(--accent); }
      .segment button:not([aria-pressed="true"]):hover { background: rgba(255,255,255,0.06); }

      .hidden { display: none !important; }

      /* テーマ（カテゴリ別の色調） */
      body.mode-normal { --accent: #3b82f6; }
      body.mode-rainbow { --accent: #8b5cf6; }
      body.mode-classic { --accent: #94a3b8; }
      body.mode-rainbow .number { background: conic-gradient(from 0deg, #ff6b6b, #ffd93d, #6bff95, #50c4ff, #a78bfa, #ff6b6b); color: #0b1020; text-shadow: 0 1px 0 rgba(255,255,255,.6); }
      body.mode-classic .number { background: radial-gradient(circle at 30% 30%, #f8fafc, #64748b); }

      /* レスポンシブ */
      @media (max-width: 900px) {
        .stage { grid-template-columns: 1fr; }
        .number { width: 180px; height: 180px; font-size: 58px; }
        .topbar-inner { grid-template-columns: 1fr; gap: 10px; }
        .dock-inner { grid-template-columns: 1fr; gap: 10px; }
        .dock-left, .dock-right { justify-content: center; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ウェルカム（開始前） -->
      <section id="welcome" class="welcome">
        <div>
          <h1>ホスト操作パネル・モック</h1>
          <p style="color: var(--muted); margin-bottom: 18px;">開始 → カテゴリ選択（通常/レインボー/クラシック）→ 操作帯 → 数字を配る の流れ。</p>
          <button id="btnStart" class="btn primary" aria-label="ゲーム開始">開始</button>
          <div class="empty-hint">Space/Enter = 開始/配る, S = シャッフル, T = お題変更, Ctrl+R = リセット</div>
        </div>
      </section>

      <!-- カテゴリ選択（開始後に表示） -->
      <section id="chooser" class="chooser hidden" aria-label="カテゴリ選択">
        <div>
          <h2>カテゴリを選択</h2>
          <div class="chooser-grid">
            <button class="tile" data-cat="normal">通常</button>
            <button class="tile" data-cat="rainbow">レインボー</button>
            <button class="tile" data-cat="classic">クラシック</button>
          </div>
        </div>
      </section>

      <!-- トップバー（カテゴリ表示/進行/リセット） -->
      <header id="topbar" class="topbar hidden" aria-label="トップバー">
        <div class="topbar-inner">
          <div class="progress">
            <span id="categoryPill" class="pill hidden">カテゴリ: —</span>
          </div>
          <div class="progress" aria-live="polite">
            <span id="progressText">未開始</span>
          </div>
          <div>
            <button id="btnReset" class="btn danger hidden" title="すべてを初期化">リセット</button>
          </div>
        </div>
      </header>

      <!-- ステージ（数字/お題/履歴） -->
      <main id="stage" class="stage hidden">
        <section class="number-wrap" aria-live="polite" aria-atomic="true">
          <div id="number" class="number" aria-label="現在の数字">–</div>
        </section>
        <aside class="side">
          <div class="card">
            <h3>お題</h3>
            <div id="topicText" class="topic">（未選択）</div>
            <div id="topicCat" class="topic-cat hidden"></div>
          </div>
          <div class="card">
            <h3>履歴</h3>
            <div id="history" class="history" aria-live="polite"></div>
          </div>
        </aside>
      </main>

      <!-- ドック（ホスト操作帯） -->
      <footer id="dock" class="dock hidden" aria-label="操作帯">
        <div class="dock-inner">
          <div class="dock-left">
            <button id="btnShuffle" class="btn" disabled>シャッフル</button>
          </div>
          <div style="display:flex; justify-content:center;">
            <button id="btnDraw" class="btn primary" disabled>数字を選ぶ</button>
          </div>
          <div class="dock-right">
            <button id="btnTopic" class="btn" disabled>お題を選びなおす</button>
          </div>
        </div>
      </footer>
    </div>

    <!-- お題選択ダイアログ（カテゴリ切替込み） -->
    <dialog id="topicDialog">
      <div class="dlg-head">お題を選びなおす</div>
      <form method="dialog">
        <div class="dlg-body">
          <div>
            <div class="segment" id="topicSeg" role="tablist" aria-label="カテゴリ">
              <button class="segCat" data-cat="normal" aria-pressed="false">通常</button>
              <button class="segCat" data-cat="rainbow" aria-pressed="false">レインボー</button>
              <button class="segCat" data-cat="classic" aria-pressed="false">クラシック</button>
            </div>
          </div>
          <div class="topic-list" id="topicList"></div>
        </div>
        <div class="dlg-foot">
          <button value="cancel" class="btn">キャンセル</button>
          <button id="topicOk" value="ok" class="btn primary">決定</button>
        </div>
      </form>
    </dialog>

    <script>
      // ===== 状態 =====
      const state = {
        started: false,
        category: null, // 'normal' | 'rainbow' | 'classic'
        topic: null,
        topicsByCategory: {
          normal: ['動物','食べ物','スポーツ','映画','音楽','国','職業','科学','季節','色'],
          rainbow: ['赤いもの','青いもの','緑のもの','カラフルな服','虹色の物','光るもの','ペイント','花','宝石','キャンディ'],
          classic: ['将棋','トランプ','チェス','ことわざ','名作文学','古典音楽','歴史人物','名画','世界遺産','伝統行事']
        },
        pool: [],   // 残りの数字
        drawn: [],  // 引いた数字の履歴
        max: 75
      };

      // ===== 要素 =====
      const $ = (sel) => document.querySelector(sel);
      const $$ = (sel) => Array.from(document.querySelectorAll(sel));
      const el = {
        welcome: $('#welcome'), chooser: $('#chooser'), topbar: $('#topbar'), stage: $('#stage'), dock: $('#dock'),
        number: $('#number'), history: $('#history'),
        progress: $('#progressText'), topicText: $('#topicText'), topicCat: $('#topicCat'),
        btnStart: $('#btnStart'), btnReset: $('#btnReset'), btnDraw: $('#btnDraw'), btnShuffle: $('#btnShuffle'), btnTopic: $('#btnTopic'),
        tiles: $$('#chooser .tile'), categoryPill: $('#categoryPill'),
        topicDialog: $('#topicDialog'), topicList: $('#topicList'), topicOk: $('#topicOk'), topicSeg: $('#topicSeg')
      };

      // ===== 初期化 =====
      function init() {
        resetPool();
        // イベント
        el.btnStart.addEventListener('click', onStart);
        el.btnReset.addEventListener('click', onReset);
        el.btnDraw.addEventListener('click', onDraw);
        el.btnShuffle.addEventListener('click', onShuffleTopic);
        el.btnTopic.addEventListener('click', openTopicDialog);
        el.tiles.forEach(b => b.addEventListener('click', () => onSelectCategory(b.dataset.cat)));
        // ダイアログ内カテゴリ切替
        $$('#topicSeg .segCat').forEach(b => b.addEventListener('click', () => setDialogCategory(b.dataset.cat)));
        // キーボードショートカット
        window.addEventListener('keydown', (e) => {
          if (!state.started) {
            if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); onStart(); }
            return;
          }
          if (e.ctrlKey && (e.key === 'r' || e.key === 'R')) { e.preventDefault(); onReset(); }
          if (!state.category) return;
          if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); onDraw(); }
          if (e.key === 's' || e.key === 'S') { e.preventDefault(); onShuffleTopic(); }
          if (e.key === 't' || e.key === 'T') { e.preventDefault(); openTopicDialog(); }
        });
        render();
      }

      function resetPool() {
        state.pool = Array.from({length: state.max}, (_,i)=> i+1);
        state.drawn = [];
        el.number.textContent = '–';
      }

      // ===== フロー =====
      function onStart() {
        if (state.started) return;
        state.started = true;
        el.welcome.classList.add('hidden');
        el.topbar.classList.remove('hidden');
        el.chooser.classList.remove('hidden');
        el.btnReset.classList.remove('hidden');
        render();
      }

      function onSelectCategory(cat) {
        if (!state.started) return;
        state.category = cat;
        applyCategoryTheme(cat);
        // 初期のお題はカテゴリ内の先頭（例）
        const list = state.topicsByCategory[cat] || [];
        state.topic = list[0] || null;
        // 表示切り替え
        el.chooser.classList.add('hidden');
        el.stage.classList.remove('hidden');
        el.dock.classList.remove('hidden');
        setEnabled([el.btnDraw, el.btnShuffle, el.btnTopic], true);
        el.categoryPill.classList.remove('hidden');
        render();
      }

      function openTopicDialog() {
        if (!state.category) return;
        // ダイアログの作業用カテゴリ
        dlg.category = state.category;
        updateDialogSeg();
        buildTopicListFor(dlg.category, state.topic);
        el.topicDialog.showModal();
      }

      const dlg = { category: null };
      function setDialogCategory(cat) {
        dlg.category = cat;
        updateDialogSeg();
        buildTopicListFor(cat, null);
      }
      function updateDialogSeg() {
        $$('#topicSeg .segCat').forEach(b => b.setAttribute('aria-pressed', String(b.dataset.cat === dlg.category)));
      }

      el.topicDialog?.addEventListener('close', () => {
        if (el.topicDialog.returnValue === 'ok') {
          const selected = document.querySelector('#topicList input[type=radio]:checked');
          // カテゴリ/お題を確定
          if (dlg.category) state.category = dlg.category;
          applyCategoryTheme(state.category);
          if (selected) state.topic = selected.value;
          // 必要UIを露出
          el.stage.classList.remove('hidden');
          el.dock.classList.remove('hidden');
          setEnabled([el.btnDraw, el.btnShuffle, el.btnTopic], true);
          el.categoryPill.classList.remove('hidden');
          render();
        }
      });

      function onShuffleTopic() {
        if (!state.category) return;
        const list = state.topicsByCategory[state.category] || [];
        if (list.length === 0) return;
        const others = list.filter(t => t !== state.topic);
        state.topic = (others[Math.floor(Math.random() * others.length)]) || list[0];
        // 軽いフィードバック
        el.topicText.style.transition = 'transform .1s';
        el.topicText.style.transform = 'scale(1.06)';
        setTimeout(()=>{ el.topicText.style.transform = 'scale(1)'; }, 120);
        render();
      }

      function onDraw() {
        if (!state.category || state.pool.length === 0) return;
        const idx = Math.floor(Math.random() * state.pool.length);
        const value = state.pool.splice(idx, 1)[0];
        state.drawn.unshift(value);
        el.number.textContent = value;
        el.number.classList.remove('bump'); void el.number.offsetWidth; el.number.classList.add('bump');
        render();
      }

      function onReset() {
        if (!confirm('すべて初期化して最初からやり直しますか？')) return;
        document.body.classList.remove('mode-normal','mode-rainbow','mode-classic');
        state.started = false; state.category = null; state.topic = null; resetPool();
        // UI 初期
        el.topbar.classList.add('hidden');
        el.stage.classList.add('hidden');
        el.dock.classList.add('hidden');
        el.chooser.classList.add('hidden');
        setEnabled([el.btnDraw, el.btnShuffle, el.btnTopic], false);
        el.btnReset.classList.add('hidden');
        el.categoryPill.classList.add('hidden');
        el.topicText.textContent = '（未選択）';
        el.topicCat.classList.add('hidden');
        el.welcome.classList.remove('hidden');
        render();
      }

      // ===== UI 補助 =====
      function setEnabled(elems, enabled) { elems.forEach(x => x.disabled = !enabled); }
      function applyCategoryTheme(cat) {
        document.body.classList.remove('mode-normal','mode-rainbow','mode-classic');
        if (cat) document.body.classList.add('mode-' + cat);
      }
      function buildTopicListFor(cat, current) {
        const list = state.topicsByCategory[cat] || [];
        el.topicList.innerHTML = list.map((t,i)=> `
          <label class="topic-item">
            <input type="radio" name="topic" value="${t}" ${current ? (t===current?'checked':'') : (i===0?'checked':'')} />
            <span>${t}</span>
          </label>
        `).join('');
      }
      function labelFor(cat) {
        return cat === 'normal' ? '通常' : cat === 'rainbow' ? 'レインボー' : cat === 'classic' ? 'クラシック' : '—';
      }

      function render() {
        // 進捗
        if (!state.started) {
          el.progress.textContent = '未開始';
        } else {
          el.progress.textContent = `${state.drawn.length} / ${state.max} （残り ${state.pool.length}）`;
        }
        // カテゴリ表示
        if (state.category) {
          el.categoryPill.textContent = `カテゴリ: ${labelFor(state.category)}`;
        }
        // お題
        el.topicText.textContent = state.topic ?? '（未選択）';
        if (state.category) {
          el.topicCat.textContent = `カテゴリ: ${labelFor(state.category)}`;
          el.topicCat.classList.remove('hidden');
        }
        // 履歴（直近12件）
        el.history.innerHTML = state.drawn.slice(0, 12).map(n => `<span class="chip">${n}</span>`).join('');
        // ボタン活性/完了
        el.btnDraw.disabled = !state.category || state.pool.length === 0;
        el.btnShuffle.disabled = !state.category;
        el.btnTopic.disabled = !state.category;
        el.btnDraw.textContent = state.pool.length ? '数字を選ぶ' : '完了';
      }

      // 起動
      init();
    </script>
  </body>
</html>

