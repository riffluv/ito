<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ITO v2 â€“ Switch Party Design</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet"/>
<style>
  /* =================== DESIGN TOKENS =================== */
  *,*::before,*::after{box-sizing:border-box}
  html,body{block-size:100%;}
  :root{
    /* Joy-Con inspired palette */
    --joy-red:#ff3c28; --joy-blue:#0ab9e6; --joy-green:#00d26a; --joy-yellow:#ffd100;
    --ink:#0e1423; --ink-1:#111a2b; --ink-2:#111a2b; --ink-3:#17223b; /* layered */
    --glass:rgba(255,255,255,.06); --line:rgba(255,255,255,.12); --text:#fff; --muted:#b8c0d4;
    --r-xl:22px; --r-lg:18px; --r-md:12px; --shadow:0 24px 48px rgba(0,0,0,.38);
    --safe-top:env(safe-area-inset-top,0px); --safe-right:env(safe-area-inset-right,0px); --safe-bottom:env(safe-area-inset-bottom,0px); --safe-left:env(safe-area-inset-left,0px);
  }
  body{
    margin:0; color:var(--text); font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; 
    min-block-size:100svh; 
    background:
      radial-gradient(1200px 600px at 12% 85%, rgba(255,60,40,.12), transparent 60%),
      radial-gradient(1200px 600px at 90% 10%, rgba(10,185,230,.12), transparent 60%),
      linear-gradient(135deg, #0e1527, #141d31 60%, #0f1731 100%);
    overflow:clip; /* bodyã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å‡ºã•ãªã„ */
  }
  @supports(min-height:100dvh){ body{ min-block-size:100dvh; } }

  /* =================== APP GRID =================== */
  .app{ block-size:100%; max-inline-size:1440px; margin-inline:auto; padding:16px; padding-top:calc(16px + var(--safe-top)); padding-bottom:calc(16px + var(--safe-bottom));
    display:grid; gap:16px;
    grid-template-areas:
      "brand  brand  brand  brand"
      "players main   main   chat"
      "board   board  board  chat"
      "hand    hand   hand   chat";
    grid-template-columns: 18rem minmax(0,1fr) minmax(0,1fr) 22rem;
    grid-template-rows: auto minmax(0,1fr) minmax(0,1fr) auto;
  }
  .panel{ background:var(--glass); border:1px solid var(--line); backdrop-filter:blur(14px); border-radius:var(--r-xl); box-shadow:var(--shadow); min-block-size:0; }

  /* =================== BRAND BAR =================== */
  .brand{ grid-area:brand; display:flex; align-items:center; justify-content:space-between; padding:14px 16px }
  .logo{ display:flex; align-items:center; gap:12px; font-weight:900; letter-spacing:.3px; font-size:clamp(18px,2.2vw,26px); }
  .glyph{ inline-size:34px; block-size:34px; border-radius:12px; background:linear-gradient(135deg,var(--joy-red),#ff7a6d); display:grid; place-items:center; box-shadow:0 10px 22px rgba(255,60,40,.35)}
  .logo b{ background:linear-gradient(135deg,var(--joy-red),var(--joy-yellow)); -webkit-background-clip:text; -webkit-text-fill-color:transparent }
  .actions{ display:flex; gap:10px; flex-wrap:wrap }
  .btn{ font:inherit; color:#091325; padding:10px 14px; border-radius:14px; border:1px solid var(--line); background:rgba(255,255,255,.08); cursor:pointer; transition:transform .12s ease, filter .12s ease }
  .btn:focus-visible{ outline:3px solid color-mix(in oklab, white 55%, var(--joy-blue)); outline-offset:2px }
  .btn:hover{ transform:translateY(-1px) }
  .btn.primary{ color:#fff; background:linear-gradient(135deg,var(--joy-red),#ff6a57); box-shadow:0 10px 26px rgba(255,60,40,.35) }
  .btn.alt{ background:linear-gradient(135deg,var(--joy-blue),#4fd0f0) }

  /* =================== PLAYERS =================== */
  .players{ grid-area:players; padding:18px }
  .title{ color:var(--joy-yellow); font-weight:900; margin:0 0 12px }
  .player{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid var(--line) }
  .player+.player{ margin-top:10px }
  .badge{ font-size:12px; font-weight:900; padding:6px 10px; border-radius:999px; color:#0e1423 }
  .b-wait{ background:linear-gradient(135deg,#f39c12,#e67e22); color:#fff }
  .b-ready{ background:linear-gradient(135deg,#2ecc71,#00d26a); color:#fff }
  .b-play{ background:linear-gradient(135deg,#4a90e2,#0ab9e6); color:#fff }

  .subgroup{ margin-top:16px }

  /* =================== MAIN =================== */
  .main{ grid-area:main; display:flex; flex-direction:column; overflow:hidden }
  .mainTop{ padding:14px 18px; background:linear-gradient(90deg, var(--joy-yellow), var(--joy-red)); border-start-start-radius:var(--r-xl); border-start-end-radius:var(--r-xl); color:#0e1423; font-weight:900 }
  .mainBody{ padding:28px 20px; min-block-size:0; overflow:auto; display:grid; place-items:center; text-align:center; gap:14px }
  .topic{ font-weight:900; line-height:1.1; font-size:clamp(22px,2.6vw,34px); background:linear-gradient(135deg,var(--joy-red),var(--joy-blue),var(--joy-yellow)); -webkit-background-clip:text; -webkit-text-fill-color:transparent }
  .topicSub{ color:var(--muted) }
  .chips{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center }
  .chip{ background:linear-gradient(135deg,#b06ab3,#c39bd3); color:#fff; padding:8px 14px; border-radius:999px; font-weight:800 }

  /* =================== CHAT + TIMER =================== */
  .chat{ grid-area:chat; padding:16px; display:grid; grid-template-rows:auto auto minmax(0,1fr) auto; gap:12px }
  .timeRow{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:10px }
  .time{ font-weight:900; font-size:clamp(22px,2.6vw,30px); color:var(--joy-yellow); text-shadow:0 0 18px var(--joy-yellow) }
  .bar{ inline-size:100%; block-size:8px; background:rgba(255,255,255,.14); border-radius:999px; overflow:hidden }
  .prog{ block-size:100%; inline-size:100%; background:linear-gradient(90deg,var(--joy-yellow),var(--joy-red)) }
  .log{ overflow:auto; min-block-size:0; padding:10px; border-radius:14px; border:1px dashed var(--line); background:rgba(0,0,0,.15); display:flex; flex-direction:column; gap:10px }
  .msg{ display:flex; gap:8px; align-items:flex-end }
  .msg.you{ justify-content:flex-end }
  .bubble{ max-inline-size:80%; padding:10px 12px; border-radius:14px; background:#26324a; border:1px solid var(--line) }
  .msg.you .bubble{ background:#2c3b59 }
  .from{ font-size:11px; color:var(--muted); margin-inline:4px }
  .chatIn{ display:flex; gap:10px }
  .chatIn input{ flex:1; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.08); color:#fff; font-weight:800 }

  /* =================== BOARD =================== */
  .board{ grid-area:board; padding:22px }
  .board h2{ text-align:center; margin:0 0 14px; font-weight:900; color:var(--joy-blue) }
  .drop{ min-block-size:200px; display:grid; grid-template-columns:repeat(auto-fit,minmax(90px,1fr)); gap:14px; align-items:start; justify-items:center; padding:18px; border-radius:16px; border:2px dashed var(--line); background:
    radial-gradient(40% 80% at 30% 70%, rgba(10,185,230,.12) 0%, transparent 60%),
    repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0px, rgba(255,255,255,.02) 10px, transparent 10px, transparent 20px);
    overflow:auto }
  .drop::before{ content:'ğŸ¯ ã‚«ãƒ¼ãƒ‰ã‚’ã“ã“ã«é…ç½®ã—ã¦ãã ã•ã„'; color:var(--muted); font-weight:800; opacity:.75 }
  .drop:not(:empty)::before{ display:none }
  .drop.drag{ border-color:var(--joy-blue); background:rgba(10,185,230,.08) }

  .card{ aspect-ratio:2/3; inline-size:90px; border-radius:14px; border:2px solid #3498db; background:linear-gradient(145deg,#2c3e50,#34495e); display:grid; place-items:center; position:relative; cursor:grab; box-shadow:0 12px 28px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.12); overflow:hidden }
  .card:hover{ transform:translateY(-6px) scale(1.03) }
  .card:active{ cursor:grabbing }
  .card::after{ content:""; position:absolute; inset:-50% auto auto -50%; inline-size:200%; block-size:200%; background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,.12) 50%, transparent 70%); transform:rotate(45deg) }
  .card .num{ font-weight:900; font-size:1.9rem; text-shadow:0 2px 8px rgba(0,0,0,.5) }
  .card .order{ position:absolute; inset:-8px -8px auto auto; inline-size:28px; block-size:28px; border-radius:50%; border:3px solid #fff; display:grid; place-items:center; font-weight:900; font-size:14px; color:#0e1423; background:linear-gradient(135deg,var(--joy-yellow),#ffb700) }
  .card .who{ position:absolute; inset:auto 50% -6px 50%; transform:translateX(-50%); font-size:10px; font-weight:800; padding:4px 10px; border-radius:10px; color:#fff; border:1px solid var(--joy-blue); background:#17223b }
  .card.hidden .num{ filter:blur(8px); opacity:.3 }
  .card.hidden::before{ content:'?'; position:absolute; inset:0; display:grid; place-items:center; font-weight:900; font-size:2rem; color:var(--joy-blue); text-shadow:0 0 16px var(--joy-blue) }

  /* =================== HAND =================== */
  .hand{ grid-area:hand; padding:18px; display:flex; gap:20px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .mine{ aspect-ratio:2/3; inline-size:110px; border-radius:14px; border:3px solid #ffd700; background:linear-gradient(145deg,var(--joy-red),var(--joy-yellow)); display:grid; place-items:center; box-shadow:0 14px 34px rgba(255,60,40,.4), 0 0 40px rgba(255,209,0,.35); cursor:grab }
  .mine .num{ font-weight:900; font-size:2.2rem; color:#0e1423 }
  .word{ flex:1; display:flex; gap:10px; align-items:center; min-inline-size:min(420px,100%) }
  .word input{ flex:1; padding:12px 14px; border-radius:12px; border:2px solid var(--line); background:rgba(255,255,255,.08); color:#fff; font-weight:800 }
  .status{ font-size:12px; font-weight:900; padding:6px 10px; border-radius:999px }
  .wait{ background:linear-gradient(135deg,#f39c12,#e67e22); color:#fff }
  .ready{ background:linear-gradient(135deg,#2ecc71,#00d26a); color:#fff }

  /* ================ RESPONSIVE ================ */
  @media (max-width: 1150px){
    .app{ grid-template-areas:
      "brand  brand  brand"
      "main   main   chat"
      "players board  chat"
      "hand    hand   chat";
      grid-template-columns: minmax(0,1fr) minmax(0,1fr) 22rem; }
  }
  @media (max-width: 820px){
    .app{ grid-template-areas:
      "brand"
      "main"
      "chat"
      "players"
      "board"
      "hand";
      grid-template-columns: 1fr; }
    .hand{ flex-direction:column; align-items:stretch }
  }
  @media (prefers-reduced-motion: reduce){ *{ transition-duration:.001ms !important; animation-duration:.001ms !important; animation-iteration-count:1 !important; scroll-behavior:auto !important } }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="ITO party game (mock-based)">
    <!-- BRAND BAR -->
    <header class="panel brand">
      <div class="logo"><span class="glyph">ğŸ®</span><span><b>ITO</b> Party</span></div>
      <div class="actions">
        <button class="btn" id="deal">ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹</button>
        <button class="btn" id="reveal">å…¨éƒ¨ã‚ãã‚‹</button>
        <button class="btn alt" id="reset">ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="btn primary" id="ready">æº–å‚™OK</button>
      </div>
    </header>

    <!-- PLAYERS -->
    <aside class="panel players">
      <div class="title">ğŸ‘¥ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ (3/3)</div>
      <div class="player"><span>ã‚ã</span><span class="badge b-wait" id="p1">æœªé…å¸ƒ</span></div>
      <div class="player"><span>chromeé€šå¸¸</span><span class="badge b-wait" id="p2">æœªé…å¸ƒ</span></div>
      <div class="player"><span>ã‚¨ãƒƒã‚¸ã§ã™ã€‚</span><span class="badge b-wait" id="p3">æœªé…å¸ƒ</span></div>

      <div class="subgroup">
        <div class="title" style="color:#8be0ff">âš™ï¸ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</div>
        <button class="btn" id="bot" style="inline-size:100%; margin-bottom:10px">é †ç•ªã«</button>
        <button class="btn" id="undo" style="inline-size:100%">ã›ãƒ¼ã®ã§ï¼</button>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="panel main">
      <div class="mainTop">ğŸ® ãƒ©ã‚¦ãƒ³ãƒ‰ 1 | ã‚«ãƒ†ã‚´ãƒª: é›‘è«‡ç³»</div>
      <div class="mainBody">
        <h1 class="topic" id="topic">ãŠé¡Œï¼šã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ã®ã‚­ãƒ£ãƒ©ã®å¼·ã•</h1>
        <p class="topicSub">ã€Œå¼±ã„ â†’ å¼·ã„ã€ã®é †ã§ã‚«ãƒ¼ãƒ‰ã‚’å ´ã«å‡ºãã†ï¼ˆå„è‡ª1æšï¼‰ã€‚</p>
        <div class="chips" id="chips"></div>
        <button class="btn" id="changeTopic" style="margin-top:8px">ãŠé¡Œå¤‰æ›´</button>
      </div>
    </main>

    <!-- CHAT + TIMER -->
    <aside class="panel chat">
      <div class="title">ğŸ’¬ ç›¸è«‡ã‚¹ãƒšãƒ¼ã‚¹</div>
      <div class="timeRow">
        <div class="time"><span id="left">40</span>s</div>
        <div style="display:flex; gap:8px">
          <button class="btn" id="startT">é–‹å§‹</button>
          <button class="btn" id="pauseT">ä¸€æ™‚åœæ­¢</button>
          <button class="btn" id="resetT">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>
      <div class="bar"><div class="prog" id="prog"></div></div>
      <div class="log" id="log" aria-live="polite"></div>
      <div class="chatIn">
        <input id="chat" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ï¼ˆEnterã§é€ä¿¡ï¼‰" maxlength="80" />
        <button class="btn alt" id="send">é€ä¿¡</button>
      </div>
    </aside>

    <!-- BOARD -->
    <section class="panel board">
      <h2>ğŸ¯ ã‚«ãƒ¼ãƒ‰ãƒœãƒ¼ãƒ‰ï¼ˆå‡ºã—ãŸé †ï¼‰</h2>
      <div class="drop" id="board" aria-live="polite"></div>
      <p style="text-align:center; margin-top:12px; color:var(--muted); font-size:.9rem">ä¼ã›ãŸã¾ã¾ä¸¦ã¹ã¦ã€æœ€å¾Œã«ã‚ãã£ã¦çµæœåˆ¤å®š</p>
    </section>

    <!-- HAND -->
    <footer class="panel hand">
      <div style="display:flex; align-items:center; gap:14px">
        <div style="color:var(--joy-yellow); font-weight:900">ğŸƒ ã‚ãªãŸã®ã‚«ãƒ¼ãƒ‰</div>
        <div class="mine hidden" id="my" draggable="true" aria-grabbed="false"><div class="num" id="myNum">--</div></div>
        <div style="display:flex; flex-direction:column; gap:8px">
          <button class="btn primary" id="play">ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™</button>
          <button class="btn" id="takeBack" disabled>å–ã‚Šæ¶ˆã—</button>
        </div>
      </div>
      <div class="word">
        <input id="hint" type="text" placeholder="ğŸ’­ é€£æƒ³ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼šãƒ”ã‚«ãƒãƒ¥ã‚¦ã€æ‚Ÿç©ºï¼‰" maxlength="20" />
        <button class="btn alt" id="pushHint">é€ä¿¡</button>
        <span class="status wait" id="hintStatus">æœªå…¥åŠ›</span>
      </div>
    </footer>
  </div>

  <!-- Toast -->
  <div id="toast" aria-live="polite" style="position:fixed; inset: max(16px, var(--safe-top)) auto auto 50%; transform:translateX(-50%); padding:14px 18px; border-radius:14px; background:linear-gradient(135deg,var(--joy-blue),#4fd0f0); color:#fff; font-weight:900; box-shadow:var(--shadow); opacity:0; pointer-events:none; transition:opacity .25s ease"></div>

<script>
  // =================== STATE ===================
  const S = {
    players:[
      { id:1, name:'ã‚ã', number:null, word:'', played:false },
      { id:2, name:'chromeé€šå¸¸', number:null, word:'', played:false },
      { id:3, name:'ã‚¨ãƒƒã‚¸ã§ã™ã€‚', number:null, word:'', played:false },
    ],
    me:1,
    timerTotal:40, timer:40, tid:null,
  };

  // =================== ELEMENTS ===================
  const $ = s=>document.querySelector(s);
  const el = {
    toast: $('#toast'), left: $('#left'), prog: $('#prog'), log: $('#log'), chat: $('#chat'),
    board: $('#board'), my: $('#my'), myNum: $('#myNum'), chips: $('#chips'), topic: $('#topic'),
    hint: $('#hint'), hintStatus: $('#hintStatus'),
    badges:[null, $('#p1'), $('#p2'), $('#p3')]
  };

  // =================== UTIL ===================
  const toast=(m,type='info')=>{ const map={success:'linear-gradient(135deg,#00d26a,#2ecc71)', error:'linear-gradient(135deg,#ff3c28,#c0392b)', info:'linear-gradient(135deg,#0ab9e6,#4fd0f0)'}; el.toast.textContent=m; el.toast.style.background=map[type]||map.info; el.toast.style.opacity=1; clearTimeout(el.toast._t); el.toast._t=setTimeout(()=>el.toast.style.opacity=0,2200); };
  const setBadge=(id,t,cls)=>{ const b=el.badges[id]; if(!b) return; b.textContent=t; b.className='badge '+cls; };
  const shuffle=(a)=>{ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; };
  const unique=(min,max,count)=> shuffle([...Array(max-min+1).keys()].map(n=>n+min)).slice(0,count);

  // card element
  const cardEl=(p,hidden=true)=>{ const d=document.createElement('div'); d.className='card'+(hidden?' hidden':''); d.dataset.playerId=p.id; d.dataset.number=p.number; d.innerHTML=`<div class="num">${p.number}</div><div class="order"></div><div class="who">${p.name}</div>`; return d; };
  const refreshOrders=()=>{ [...el.board.querySelectorAll('.card')].forEach((c,i)=> c.querySelector('.order').textContent = i+1 ); };
  const refreshChips=()=>{ el.chips.innerHTML=''; S.players.forEach(p=>{ if(p.word.trim()){ const k=document.createElement('div'); k.className='chip'; k.textContent=`${p.name}: ${p.word}`; el.chips.appendChild(k); } }); };

  // =================== TIMER (chat side) ===================
  const setTime=n=>{ S.timer=n; el.left.textContent=n; el.prog.style.width=`${(n/S.timerTotal)*100}%`; };
  const startT=()=>{ clearInterval(S.tid); S.tid=setInterval(()=>{ setTime(Math.max(0,S.timer-1)); if(S.timer<=0){ clearInterval(S.tid); pushSys('â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼'); } },1000); };
  const pauseT=()=> clearInterval(S.tid);
  const resetT=()=>{ pauseT(); setTime(S.timerTotal); };

  // =================== CHAT ===================
  const pushLine=(from,txt,me=false)=>{ const node=document.createElement('div'); node.className='msg'+(me?' you':''); node.innerHTML = `${!me?`<span class='from'>${from}</span>`:''}<div class='bubble'>${txt.replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]))}</div>`; el.log.appendChild(node); el.log.scrollTop=el.log.scrollHeight; };
  const pushSys=(msg)=>{ pushLine('SYSTEM',msg); toast(msg,'info'); };

  // =================== GAME ===================
  const deal=()=>{ const nums=unique(1,100,S.players.length); S.players.forEach((p,i)=>{ p.number=nums[i]; p.word=''; p.played=false; setBadge(p.id,'é…å¸ƒæ¸ˆã¿','b-ready'); }); const me=S.players.find(p=>p.id===S.me); el.myNum.textContent=me.number; el.my.classList.remove('hidden'); el.board.innerHTML=''; refreshChips(); el.hint.value=''; el.hintStatus.textContent='æœªå…¥åŠ›'; el.hintStatus.className='status wait'; $('#takeBack').disabled=true; pushSys('ğŸ´ ã‚«ãƒ¼ãƒ‰é…å¸ƒã—ã¾ã—ãŸ'); resetT(); };
  const play=(p)=>{ if(!p.number||p.played) return; p.played=true; el.board.appendChild(cardEl(p,true)); refreshOrders(); setBadge(p.id,'å‡ºã—ãŸ','b-play'); if(p.id===S.me){ $('#takeBack').disabled=false; toast('âœ¨ ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã—ã¾ã—ãŸï¼','success'); } };
  const takeBack=()=>{ const cs=el.board.querySelectorAll('.card'); const last=cs[cs.length-1]; if(!last) return; const pid=Number(last.dataset.playerId); if(pid!==S.me) return; const p=S.players.find(x=>x.id===pid); p.played=false; last.remove(); refreshOrders(); setBadge(pid,'é…å¸ƒæ¸ˆã¿','b-ready'); $('#takeBack').disabled=true; toast('â†©ï¸ å–ã‚Šæ¶ˆã—','info'); };
  const reveal=()=>{ const cs=[...el.board.querySelectorAll('.card')]; if(!cs.length){ toast('âŒ ã¾ã ã‚«ãƒ¼ãƒ‰ãŒå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“','error'); return; } cs.forEach(c=>c.classList.remove('hidden')); const nums=cs.map(c=>+c.dataset.number); const ok=nums.every((n,i)=> i===0||nums[i-1]<n); setTimeout(()=>{ if(ok){ toast('ğŸ‰ æˆåŠŸï¼ï¼','success'); S.players.forEach(p=>p.played&&setBadge(p.id,'æˆåŠŸ','b-ready')); } else { toast('ğŸ’¥ å¤±æ•—...','error'); S.players.forEach(p=>p.played&&setBadge(p.id,'å¤±æ•—','b-wait')); } },400); };
  const bot=()=>{ if(S._bot){ clearInterval(S._bot); S._bot=null; pushSys('ğŸ¤– BOTåœæ­¢'); return; } const others=S.players.filter(p=>p.id!==S.me); S._bot=setInterval(()=>{ const a=others.filter(p=>!p.played&&p.number); if(!a.length){ clearInterval(S._bot); S._bot=null; return; } const p=a[Math.floor(Math.random()*a.length)]; if(!p.word){ const s=['å¼·æ•µ','ä¸­ç´š','åˆç´š','æœ€å¼·','æ™®é€š']; p.word=s[Math.floor(Math.random()*s.length)]; refreshChips(); } play(p); },1700); pushSys('ğŸ¤– BOTè‡ªå‹•ãƒ—ãƒ¬ã‚¤é–‹å§‹'); };
  const sendHint=()=>{ const w=el.hint.value.trim(); if(!w){ toast('â— ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„','error'); return; } const me=S.players.find(p=>p.id===S.me); me.word=w; el.hintStatus.textContent=w; el.hintStatus.className='status ready'; refreshChips(); toast('ğŸ’­ ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼','success'); };

  // DnD
  el.my.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', String(S.me)); el.my.style.opacity='.6'; });
  el.my.addEventListener('dragend',()=>{ el.my.style.opacity='1'; });
  el.board.addEventListener('dragover',e=>{ e.preventDefault(); el.board.classList.add('drag'); });
  el.board.addEventListener('dragleave',()=> el.board.classList.remove('drag'));
  el.board.addEventListener('drop',e=>{ e.preventDefault(); el.board.classList.remove('drag'); const me=S.players.find(p=>p.id===S.me); if(me && !me.played) play(me); });

  // =================== EVENTS ===================
  $('#deal').addEventListener('click',deal);
  $('#play').addEventListener('click',()=> play(S.players.find(p=>p.id===S.me)) );
  $('#takeBack').addEventListener('click',takeBack);
  $('#reveal').addEventListener('click',reveal);
  $('#bot').addEventListener('click',bot);
  $('#pushHint').addEventListener('click',sendHint);
  $('#hint').addEventListener('keydown',e=>{ if(e.key==='Enter') sendHint(); });

  $('#send').addEventListener('click',()=>{ const v=el.chat.value.trim(); if(!v) return; pushLine('ã‚ãªãŸ',v,true); el.chat.value=''; });
  $('#chat').addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); const v=el.chat.value.trim(); if(!v) return; pushLine('ã‚ãªãŸ',v,true); el.chat.value=''; } });

  $('#startT').addEventListener('click',startT);
  $('#pauseT').addEventListener('click',pauseT);
  $('#resetT').addEventListener('click',resetT);

  const topics=[
    `ãŠé¡Œï¼šã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ã®ã‚­ãƒ£ãƒ©ã®å¼·ã•`,
    `ãŠé¡Œï¼šã‚¢ã‚¤ã‚¹ã®ã€Œã•ã£ã±ã‚Šåº¦ã€`,
    `ãŠé¡Œï¼šãƒ›ãƒ©ãƒ¼æ˜ ç”»ã®ã€Œæ€–ã•ã€`,
    `ãŠé¡Œï¼šå‹•ç‰©ã®ã€Œä¿Šæ•ã•ã€`,
    `ãŠé¡Œï¼šæ–™ç†ã®ã€Œè¾›ã•ã€`,
    `ãŠé¡Œï¼šä¹—ã‚Šç‰©ã®ã€Œé€Ÿã•ã€`,
    `ãŠé¡Œï¼šæ¥½å™¨ã®ã€ŒéŸ³ã®é«˜ã•ã€`,
    `ãŠé¡Œï¼šå»ºç‰©ã®ã€Œé«˜ã•ã€`,
  ];
  $('#changeTopic').addEventListener('click',()=>{ let next; const cur=el.topic.textContent; do{ next = topics[Math.floor(Math.random()*topics.length)]; }while(next===cur); el.topic.textContent = next; toast('ğŸ¯ ãŠé¡Œå¤‰æ›´','info'); });

  // init
  setTime(S.timerTotal);
  pushSys('ã“ã“ã¯ç›¸è«‡ãƒãƒ£ãƒƒãƒˆæ¬„ã€‚ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã—ã¦ä½œæˆ¦ä¼šè­°ï¼');
</script>
</body>
</html>
